!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("vdp-lib",[],n):"object"==typeof exports?exports["vdp-lib"]=n():t["vdp-lib"]=n()}(window,function(){return function(t){var n={};function r(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=n,r.d=function(t,n,e){r.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},r.t=function(t,n){if(1&n&&(t=r(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.u)return t;var e=Object.create(null);if(r.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)r.d(e,i,function(n){return t[n]}.bind(null,i));return e},r.n=function(t){var n=t&&t.u?function(){return t.default}:function(){return t};return r.d(n,"a",n),n},r.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},r.p="",r(r.s=11)}([function(t,n,r){"use strict";var e,i;r.d(n,"i",function(){return e}),r.d(n,"h",function(){return i}),r.d(n,"b",function(){return a}),r.d(n,"a",function(){return u}),r.d(n,"g",function(){return s}),r.d(n,"j",function(){return h}),r.d(n,"e",function(){return l}),r.d(n,"d",function(){return v}),r.d(n,"c",function(){return p}),r.d(n,"k",function(){return M}),r.d(n,"f",function(){return _}),r.d(n,"o",function(){return m}),r.d(n,"l",function(){return x}),r.d(n,"s",function(){return w}),r.d(n,"r",function(){return y}),r.d(n,"t",function(){return b}),r.d(n,"q",function(){return g}),r.d(n,"n",function(){return S}),r.d(n,"m",function(){return O}),r.d(n,"p",function(){return C});var o,a=1024,u=1024,f=1024,c=1024,s=256,h=!1,l=2048,v=16,p=12,M=!0,d=!0,_=32768,m=[1,1,1,1],x=[-1,-1,-1,-1];function w(t,n,r){void 0===r&&(r=!1),e=t,i=n,h=r}function y(t,n){o=t,s=n}function b(t,n){f=t,c=n}function g(t,n){a=t,u=n}function S(){var t="float("+255/256*(256/o)+")",n="float("+16/o/16+")";return"\nfloat readTexel8(float x, float y) {\n\tint texelId = int(x / 4.0);\n\tvec4 read = texture2D(uSamplerSprites, vec2(float(texelId) / "+f+".0, y / "+c+".0));\n\tint texelC = int(x) - texelId * 4;\n\tif (texelC == 0) return read.r * "+t+";\n\tif (texelC == 1) return read.g * "+t+";\n\tif (texelC == 2) return read.b * "+t+";\n\treturn read.a * "+t+";\n}\n\nfloat extractTexelHi(float colorComp) {\n\tint intValue = int(colorComp * 255.0);\n\treturn float(intValue / 16) * "+n+";\n}\n\nfloat extractTexelLo(float colorComp) {\n\tint intValue = int(colorComp * 255.0);\n\treturn float(intValue - (intValue / 16) * 16) * "+n+";\n\t//return float(mod(float(intValue), 16.0)) * "+n+";\n}\n\nfloat readTexel4(float x, float y) {\n\tint texelId = int(x / 8.0);\n\tvec4 read = texture2D(uSamplerSprites, vec2(float(texelId) / "+f+".0, y / "+c+".0));\n\tint texelC = int(x) - texelId * 8;\n\t\n\tif (texelC == 0) return extractTexelHi(read.r);\n\tif (texelC == 1) return extractTexelLo(read.r);\n\tif (texelC == 2) return extractTexelHi(read.g);\n\tif (texelC == 3) return extractTexelLo(read.g);\n\tif (texelC == 4) return extractTexelHi(read.b);\n\tif (texelC == 5) return extractTexelLo(read.b);\n\tif (texelC == 6) return extractTexelHi(read.a);\n\treturn extractTexelLo(read.a);\n\t//return 9.0 * "+n+";\n}"}function O(t){return void 0===t&&(t=!0),"vec4 readColorSwapBuffer(int bufferNo, float horizOffset) {\n\tvec4 read = texture2D(uSamplerOthers, vec2(("+i+".0 - horizOffset) / "+l+".0, float(bufferNo) / "+v+".0));\n\treturn vec4(read.xyz, 1.0);\n}\n\nvec4 readPalette(highp float x, highp float y) {\n\thighp float index = x * "+o+".0 + (y * "+s+".0) * 256.0;\n\t"+(t?"if (x < "+1/o+") discard;":"")+"\n\tif (index == uColorSwaps[0]) return readColorSwapBuffer("+p+", gl_FragCoord.y);\n\tif (index == uColorSwaps[1]) return readColorSwapBuffer("+(p+1)+", gl_FragCoord.y);\n\tif (index == uColorSwaps[2]) return readColorSwapBuffer("+(p+2)+", gl_FragCoord.y);\n\tif (index == uColorSwaps[3]) return readColorSwapBuffer("+(p+3)+", gl_FragCoord.y);\n\treturn texture2D(uSamplerPalettes, vec2(x, y));\n}"}function C(t){return d?"vec4(("+t+").rgb * uEnvColor.rgb, 1)":t+" * uEnvColor"}},function(t,n,r){"use strict";r.d(n,"a",function(){return e});var e=function(){function t(){}return t.extract=function(n,r){return void 0===r&&(r=8),{a:(n=t.posterize(n,r))>>>24,b:n>>>16&255,g:n>>>8&255,r:255&n}},t.make=function(t,n,r,e){if("number"==typeof t)return"number"!=typeof e&&(e=255),"number"!=typeof r?t:Math.ceil(Math.max(0,Math.min(255,t)))|Math.ceil(Math.max(0,Math.min(255,n)))<<8|Math.ceil(Math.max(0,Math.min(255,r)))<<16|Math.ceil(Math.max(0,Math.min(255,e)))<<24;if("string"==typeof t)switch("#"!==t.charAt(0)&&(t=""),t.length){case 4:return t=parseInt(t.substring(1),16),this.extendColor12(t<<4|15);case 5:return t=parseInt(t.substring(1),16),this.extendColor12(t);case 7:return t=parseInt(t.substring(1),16),this.reversecolor(t<<8|255);case 9:return t=parseInt(t.substring(1),16),this.reversecolor(t);default:throw new Error("Invalid color string "+t)}return this.make(t.r,t.g,t.b,t.a)},t.makeFromFloat=function(t,n,r,e){return void 0===e&&(e=1),this.make(255*t,255*n,255*r,255*e)},t.makeFromHsl=function(t){var n,r,e;if(0==t.s)n=r=e=t.l;else{function i(t,n,r){return(r-=Math.floor(r))<1/6?t+6*(n-t)*r:r<.5?n:r<2/3?t+(n-t)*(2/3-r)*6:t}var o=t.l<.5?t.l*(1+t.s):t.l+t.s-t.l*t.s,a=2*t.l-o;n=i(a,o,t.h+1/3),r=i(a,o,t.h),e=i(a,o,t.h-1/3)}return this.make(255*n,255*r,255*e)},t.extendColor12=function(n){return t.reversecolor(15&n|(15&n)<<4|(240&n)<<4|(240&n)<<8|(3840&n)<<8|(3840&n)<<12|(61440&n)<<12|(61440&n)<<16)},t.posterize=function(t,n){if(2===n){var r=t>>>6&16843009|t>>>7&16843009;return(r|=r<<1)|r<<2|(t=t>>>6&50529027)<<4|t<<6}if(3===n){r=t>>>6&50529027;return(t=t>>>5&117901063)|t<<5|t<<2|r}if(4===n)return(t=t>>>4&252645135)|t<<4;if(5===n){r=t>>>5&117901063;return(t=t>>>3&522133279)<<3|r}return t},t.reversecolor=function(t){return(255&t)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255},t.toHsl=function(t){var n,r,e=this.extract(t),i=e.r/255,o=e.g/255,a=e.b/255,u=Math.max(i,o,a),f=Math.min(i,o,a),c=(u+f)/2;if(u==f)n=r=0;else{var s=u-f;switch(r=c>.5?s/(2-u-f):s/(u+f),u){case i:n=(o-a)/s+(o<a?6:0);break;case o:n=(a-i)/s+2;break;case a:n=(i-o)/s+4}n/=6}return{h:n,s:r,l:c}},t.add=function(t,n){var r=(t>>>24)+(n>>>24),e=(t>>>16&255)+(n>>>16&255),i=(t>>>8&255)+(n>>>8&255),o=(255&t)+(255&n);return r>255&&(r=255),e>255&&(e=255),i>255&&(i=255),o>255&&(o=255),o|i<<8|e<<16|r<<24},t.sub=function(t,n){var r=(t>>>24)-(n>>>24),e=(t>>>16&255)-(n>>>16&255),i=(t>>>8&255)-(n>>>8&255),o=(255&t)-(255&n);return r<0&&(r=0),e<0&&(e=0),i<0&&(i=0),o<0&&(o=0),o|i<<8|e<<16|r<<24},t.mul=function(t,n){return(255&t)*(255&n)/255|(t>>>8&255)*(n>>>8&255)/255<<8|(t>>>16&255)*(n>>>16&255)/255<<16|(t>>>24)*(n>>>24)/255<<24},t.blend=function(t,n,r){var e=1-(r=Math.min(1,Math.max(0,r)));return(255&t)*e+(255&n)*r|(t>>>8&255)*e+(n>>>8&255)*r<<8|(t>>>16&255)*e+(n>>>16&255)*r<<16|(t>>>24)*e+(n>>>24)*r<<24},t}()},function(t,n,r){"use strict";var e={};r.r(e),r.d(e,"create",function(){return c}),r.d(e,"fromMat4",function(){return s}),r.d(e,"clone",function(){return h}),r.d(e,"copy",function(){return l}),r.d(e,"fromValues",function(){return v}),r.d(e,"set",function(){return p}),r.d(e,"identity",function(){return M}),r.d(e,"transpose",function(){return d}),r.d(e,"invert",function(){return _}),r.d(e,"adjoint",function(){return m}),r.d(e,"determinant",function(){return x}),r.d(e,"multiply",function(){return w}),r.d(e,"translate",function(){return y}),r.d(e,"rotate",function(){return b}),r.d(e,"scale",function(){return g}),r.d(e,"fromTranslation",function(){return S}),r.d(e,"fromRotation",function(){return O}),r.d(e,"fromScaling",function(){return C}),r.d(e,"fromMat2d",function(){return T}),r.d(e,"fromQuat",function(){return P}),r.d(e,"normalFromMat4",function(){return E}),r.d(e,"projection",function(){return I}),r.d(e,"str",function(){return A}),r.d(e,"frob",function(){return D}),r.d(e,"add",function(){return z}),r.d(e,"subtract",function(){return j}),r.d(e,"multiplyScalar",function(){return B}),r.d(e,"multiplyScalarAndAdd",function(){return k}),r.d(e,"exactEquals",function(){return L}),r.d(e,"equals",function(){return U}),r.d(e,"mul",function(){return F}),r.d(e,"sub",function(){return N});var i={};r.r(i),r.d(i,"create",function(){return V}),r.d(i,"clone",function(){return q}),r.d(i,"copy",function(){return R}),r.d(i,"fromValues",function(){return W}),r.d(i,"set",function(){return X}),r.d(i,"identity",function(){return K}),r.d(i,"transpose",function(){return Y}),r.d(i,"invert",function(){return G}),r.d(i,"adjoint",function(){return H}),r.d(i,"determinant",function(){return J}),r.d(i,"multiply",function(){return Q}),r.d(i,"translate",function(){return Z}),r.d(i,"scale",function(){return $}),r.d(i,"rotate",function(){return tt}),r.d(i,"rotateX",function(){return nt}),r.d(i,"rotateY",function(){return rt}),r.d(i,"rotateZ",function(){return et}),r.d(i,"fromTranslation",function(){return it}),r.d(i,"fromScaling",function(){return ot}),r.d(i,"fromRotation",function(){return at}),r.d(i,"fromXRotation",function(){return ut}),r.d(i,"fromYRotation",function(){return ft}),r.d(i,"fromZRotation",function(){return ct}),r.d(i,"fromRotationTranslation",function(){return st}),r.d(i,"fromQuat2",function(){return ht}),r.d(i,"getTranslation",function(){return lt}),r.d(i,"getScaling",function(){return vt}),r.d(i,"getRotation",function(){return pt}),r.d(i,"fromRotationTranslationScale",function(){return Mt}),r.d(i,"fromRotationTranslationScaleOrigin",function(){return dt}),r.d(i,"fromQuat",function(){return _t}),r.d(i,"frustum",function(){return mt}),r.d(i,"perspective",function(){return xt}),r.d(i,"perspectiveFromFieldOfView",function(){return wt}),r.d(i,"ortho",function(){return yt}),r.d(i,"lookAt",function(){return bt}),r.d(i,"targetTo",function(){return gt}),r.d(i,"str",function(){return St}),r.d(i,"frob",function(){return Ot}),r.d(i,"add",function(){return Ct}),r.d(i,"subtract",function(){return Tt}),r.d(i,"multiplyScalar",function(){return Pt}),r.d(i,"multiplyScalarAndAdd",function(){return Et}),r.d(i,"exactEquals",function(){return It}),r.d(i,"equals",function(){return At}),r.d(i,"mul",function(){return Dt}),r.d(i,"sub",function(){return zt});var o={};r.r(o),r.d(o,"create",function(){return jt}),r.d(o,"clone",function(){return Bt}),r.d(o,"fromValues",function(){return kt}),r.d(o,"copy",function(){return Lt}),r.d(o,"set",function(){return Ut}),r.d(o,"add",function(){return Ft}),r.d(o,"subtract",function(){return Nt}),r.d(o,"multiply",function(){return Vt}),r.d(o,"divide",function(){return qt}),r.d(o,"ceil",function(){return Rt}),r.d(o,"floor",function(){return Wt}),r.d(o,"min",function(){return Xt}),r.d(o,"max",function(){return Kt}),r.d(o,"round",function(){return Yt}),r.d(o,"scale",function(){return Gt}),r.d(o,"scaleAndAdd",function(){return Ht}),r.d(o,"distance",function(){return Jt}),r.d(o,"squaredDistance",function(){return Qt}),r.d(o,"length",function(){return Zt}),r.d(o,"squaredLength",function(){return $t}),r.d(o,"negate",function(){return tn}),r.d(o,"inverse",function(){return nn}),r.d(o,"normalize",function(){return rn}),r.d(o,"dot",function(){return en}),r.d(o,"cross",function(){return on}),r.d(o,"lerp",function(){return an}),r.d(o,"random",function(){return un}),r.d(o,"transformMat2",function(){return fn}),r.d(o,"transformMat2d",function(){return cn}),r.d(o,"transformMat3",function(){return sn}),r.d(o,"transformMat4",function(){return hn}),r.d(o,"rotate",function(){return ln}),r.d(o,"angle",function(){return vn}),r.d(o,"zero",function(){return pn}),r.d(o,"str",function(){return Mn}),r.d(o,"exactEquals",function(){return dn}),r.d(o,"equals",function(){return _n}),r.d(o,"len",function(){return xn}),r.d(o,"sub",function(){return wn}),r.d(o,"mul",function(){return yn}),r.d(o,"div",function(){return bn}),r.d(o,"dist",function(){return gn}),r.d(o,"sqrDist",function(){return Sn}),r.d(o,"sqrLen",function(){return On}),r.d(o,"forEach",function(){return Cn});var a=1e-6,u="undefined"!=typeof Float32Array?Float32Array:Array,f=Math.random;Math.PI;function c(){var t=new u(9);return u!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function s(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t}function h(t){var n=new u(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n}function l(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t}function v(t,n,r,e,i,o,a,f,c){var s=new u(9);return s[0]=t,s[1]=n,s[2]=r,s[3]=e,s[4]=i,s[5]=o,s[6]=a,s[7]=f,s[8]=c,s}function p(t,n,r,e,i,o,a,u,f,c){return t[0]=n,t[1]=r,t[2]=e,t[3]=i,t[4]=o,t[5]=a,t[6]=u,t[7]=f,t[8]=c,t}function M(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function d(t,n){if(t===n){var r=n[1],e=n[2],i=n[5];t[1]=n[3],t[2]=n[6],t[3]=r,t[5]=n[7],t[6]=e,t[7]=i}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t}function _(t,n){var r=n[0],e=n[1],i=n[2],o=n[3],a=n[4],u=n[5],f=n[6],c=n[7],s=n[8],h=s*a-u*c,l=-s*o+u*f,v=c*o-a*f,p=r*h+e*l+i*v;return p?(p=1/p,t[0]=h*p,t[1]=(-s*e+i*c)*p,t[2]=(u*e-i*a)*p,t[3]=l*p,t[4]=(s*r-i*f)*p,t[5]=(-u*r+i*o)*p,t[6]=v*p,t[7]=(-c*r+e*f)*p,t[8]=(a*r-e*o)*p,t):null}function m(t,n){var r=n[0],e=n[1],i=n[2],o=n[3],a=n[4],u=n[5],f=n[6],c=n[7],s=n[8];return t[0]=a*s-u*c,t[1]=i*c-e*s,t[2]=e*u-i*a,t[3]=u*f-o*s,t[4]=r*s-i*f,t[5]=i*o-r*u,t[6]=o*c-a*f,t[7]=e*f-r*c,t[8]=r*a-e*o,t}function x(t){var n=t[0],r=t[1],e=t[2],i=t[3],o=t[4],a=t[5],u=t[6],f=t[7],c=t[8];return n*(c*o-a*f)+r*(-c*i+a*u)+e*(f*i-o*u)}function w(t,n,r){var e=n[0],i=n[1],o=n[2],a=n[3],u=n[4],f=n[5],c=n[6],s=n[7],h=n[8],l=r[0],v=r[1],p=r[2],M=r[3],d=r[4],_=r[5],m=r[6],x=r[7],w=r[8];return t[0]=l*e+v*a+p*c,t[1]=l*i+v*u+p*s,t[2]=l*o+v*f+p*h,t[3]=M*e+d*a+_*c,t[4]=M*i+d*u+_*s,t[5]=M*o+d*f+_*h,t[6]=m*e+x*a+w*c,t[7]=m*i+x*u+w*s,t[8]=m*o+x*f+w*h,t}function y(t,n,r){var e=n[0],i=n[1],o=n[2],a=n[3],u=n[4],f=n[5],c=n[6],s=n[7],h=n[8],l=r[0],v=r[1];return t[0]=e,t[1]=i,t[2]=o,t[3]=a,t[4]=u,t[5]=f,t[6]=l*e+v*a+c,t[7]=l*i+v*u+s,t[8]=l*o+v*f+h,t}function b(t,n,r){var e=n[0],i=n[1],o=n[2],a=n[3],u=n[4],f=n[5],c=n[6],s=n[7],h=n[8],l=Math.sin(r),v=Math.cos(r);return t[0]=v*e+l*a,t[1]=v*i+l*u,t[2]=v*o+l*f,t[3]=v*a-l*e,t[4]=v*u-l*i,t[5]=v*f-l*o,t[6]=c,t[7]=s,t[8]=h,t}function g(t,n,r){var e=r[0],i=r[1];return t[0]=e*n[0],t[1]=e*n[1],t[2]=e*n[2],t[3]=i*n[3],t[4]=i*n[4],t[5]=i*n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t}function S(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=n[0],t[7]=n[1],t[8]=1,t}function O(t,n){var r=Math.sin(n),e=Math.cos(n);return t[0]=e,t[1]=r,t[2]=0,t[3]=-r,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function C(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=n[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function T(t,n){return t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[2],t[4]=n[3],t[5]=0,t[6]=n[4],t[7]=n[5],t[8]=1,t}function P(t,n){var r=n[0],e=n[1],i=n[2],o=n[3],a=r+r,u=e+e,f=i+i,c=r*a,s=e*a,h=e*u,l=i*a,v=i*u,p=i*f,M=o*a,d=o*u,_=o*f;return t[0]=1-h-p,t[3]=s-_,t[6]=l+d,t[1]=s+_,t[4]=1-c-p,t[7]=v-M,t[2]=l-d,t[5]=v+M,t[8]=1-c-h,t}function E(t,n){var r=n[0],e=n[1],i=n[2],o=n[3],a=n[4],u=n[5],f=n[6],c=n[7],s=n[8],h=n[9],l=n[10],v=n[11],p=n[12],M=n[13],d=n[14],_=n[15],m=r*u-e*a,x=r*f-i*a,w=r*c-o*a,y=e*f-i*u,b=e*c-o*u,g=i*c-o*f,S=s*M-h*p,O=s*d-l*p,C=s*_-v*p,T=h*d-l*M,P=h*_-v*M,E=l*_-v*d,I=m*E-x*P+w*T+y*C-b*O+g*S;return I?(I=1/I,t[0]=(u*E-f*P+c*T)*I,t[1]=(f*C-a*E-c*O)*I,t[2]=(a*P-u*C+c*S)*I,t[3]=(i*P-e*E-o*T)*I,t[4]=(r*E-i*C+o*O)*I,t[5]=(e*C-r*P-o*S)*I,t[6]=(M*g-d*b+_*y)*I,t[7]=(d*w-p*g-_*x)*I,t[8]=(p*b-M*w+_*m)*I,t):null}function I(t,n,r){return t[0]=2/n,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function A(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function D(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))}function z(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t[3]=n[3]+r[3],t[4]=n[4]+r[4],t[5]=n[5]+r[5],t[6]=n[6]+r[6],t[7]=n[7]+r[7],t[8]=n[8]+r[8],t}function j(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2],t[3]=n[3]-r[3],t[4]=n[4]-r[4],t[5]=n[5]-r[5],t[6]=n[6]-r[6],t[7]=n[7]-r[7],t[8]=n[8]-r[8],t}function B(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=n[7]*r,t[8]=n[8]*r,t}function k(t,n,r,e){return t[0]=n[0]+r[0]*e,t[1]=n[1]+r[1]*e,t[2]=n[2]+r[2]*e,t[3]=n[3]+r[3]*e,t[4]=n[4]+r[4]*e,t[5]=n[5]+r[5]*e,t[6]=n[6]+r[6]*e,t[7]=n[7]+r[7]*e,t[8]=n[8]+r[8]*e,t}function L(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]}function U(t,n){var r=t[0],e=t[1],i=t[2],o=t[3],u=t[4],f=t[5],c=t[6],s=t[7],h=t[8],l=n[0],v=n[1],p=n[2],M=n[3],d=n[4],_=n[5],m=n[6],x=n[7],w=n[8];return Math.abs(r-l)<=a*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(e-v)<=a*Math.max(1,Math.abs(e),Math.abs(v))&&Math.abs(i-p)<=a*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-M)<=a*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(u-d)<=a*Math.max(1,Math.abs(u),Math.abs(d))&&Math.abs(f-_)<=a*Math.max(1,Math.abs(f),Math.abs(_))&&Math.abs(c-m)<=a*Math.max(1,Math.abs(c),Math.abs(m))&&Math.abs(s-x)<=a*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(h-w)<=a*Math.max(1,Math.abs(h),Math.abs(w))}var F=w,N=j;function V(){var t=new u(16);return u!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function q(t){var n=new u(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function R(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function W(t,n,r,e,i,o,a,f,c,s,h,l,v,p,M,d){var _=new u(16);return _[0]=t,_[1]=n,_[2]=r,_[3]=e,_[4]=i,_[5]=o,_[6]=a,_[7]=f,_[8]=c,_[9]=s,_[10]=h,_[11]=l,_[12]=v,_[13]=p,_[14]=M,_[15]=d,_}function X(t,n,r,e,i,o,a,u,f,c,s,h,l,v,p,M,d){return t[0]=n,t[1]=r,t[2]=e,t[3]=i,t[4]=o,t[5]=a,t[6]=u,t[7]=f,t[8]=c,t[9]=s,t[10]=h,t[11]=l,t[12]=v,t[13]=p,t[14]=M,t[15]=d,t}function K(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Y(t,n){if(t===n){var r=n[1],e=n[2],i=n[3],o=n[6],a=n[7],u=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=r,t[6]=n[9],t[7]=n[13],t[8]=e,t[9]=o,t[11]=n[14],t[12]=i,t[13]=a,t[14]=u}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t}function G(t,n){var r=n[0],e=n[1],i=n[2],o=n[3],a=n[4],u=n[5],f=n[6],c=n[7],s=n[8],h=n[9],l=n[10],v=n[11],p=n[12],M=n[13],d=n[14],_=n[15],m=r*u-e*a,x=r*f-i*a,w=r*c-o*a,y=e*f-i*u,b=e*c-o*u,g=i*c-o*f,S=s*M-h*p,O=s*d-l*p,C=s*_-v*p,T=h*d-l*M,P=h*_-v*M,E=l*_-v*d,I=m*E-x*P+w*T+y*C-b*O+g*S;return I?(I=1/I,t[0]=(u*E-f*P+c*T)*I,t[1]=(i*P-e*E-o*T)*I,t[2]=(M*g-d*b+_*y)*I,t[3]=(l*b-h*g-v*y)*I,t[4]=(f*C-a*E-c*O)*I,t[5]=(r*E-i*C+o*O)*I,t[6]=(d*w-p*g-_*x)*I,t[7]=(s*g-l*w+v*x)*I,t[8]=(a*P-u*C+c*S)*I,t[9]=(e*C-r*P-o*S)*I,t[10]=(p*b-M*w+_*m)*I,t[11]=(h*w-s*b-v*m)*I,t[12]=(u*O-a*T-f*S)*I,t[13]=(r*T-e*O+i*S)*I,t[14]=(M*x-p*y-d*m)*I,t[15]=(s*y-h*x+l*m)*I,t):null}function H(t,n){var r=n[0],e=n[1],i=n[2],o=n[3],a=n[4],u=n[5],f=n[6],c=n[7],s=n[8],h=n[9],l=n[10],v=n[11],p=n[12],M=n[13],d=n[14],_=n[15];return t[0]=u*(l*_-v*d)-h*(f*_-c*d)+M*(f*v-c*l),t[1]=-(e*(l*_-v*d)-h*(i*_-o*d)+M*(i*v-o*l)),t[2]=e*(f*_-c*d)-u*(i*_-o*d)+M*(i*c-o*f),t[3]=-(e*(f*v-c*l)-u*(i*v-o*l)+h*(i*c-o*f)),t[4]=-(a*(l*_-v*d)-s*(f*_-c*d)+p*(f*v-c*l)),t[5]=r*(l*_-v*d)-s*(i*_-o*d)+p*(i*v-o*l),t[6]=-(r*(f*_-c*d)-a*(i*_-o*d)+p*(i*c-o*f)),t[7]=r*(f*v-c*l)-a*(i*v-o*l)+s*(i*c-o*f),t[8]=a*(h*_-v*M)-s*(u*_-c*M)+p*(u*v-c*h),t[9]=-(r*(h*_-v*M)-s*(e*_-o*M)+p*(e*v-o*h)),t[10]=r*(u*_-c*M)-a*(e*_-o*M)+p*(e*c-o*u),t[11]=-(r*(u*v-c*h)-a*(e*v-o*h)+s*(e*c-o*u)),t[12]=-(a*(h*d-l*M)-s*(u*d-f*M)+p*(u*l-f*h)),t[13]=r*(h*d-l*M)-s*(e*d-i*M)+p*(e*l-i*h),t[14]=-(r*(u*d-f*M)-a*(e*d-i*M)+p*(e*f-i*u)),t[15]=r*(u*l-f*h)-a*(e*l-i*h)+s*(e*f-i*u),t}function J(t){var n=t[0],r=t[1],e=t[2],i=t[3],o=t[4],a=t[5],u=t[6],f=t[7],c=t[8],s=t[9],h=t[10],l=t[11],v=t[12],p=t[13],M=t[14],d=t[15];return(n*a-r*o)*(h*d-l*M)-(n*u-e*o)*(s*d-l*p)+(n*f-i*o)*(s*M-h*p)+(r*u-e*a)*(c*d-l*v)-(r*f-i*a)*(c*M-h*v)+(e*f-i*u)*(c*p-s*v)}function Q(t,n,r){var e=n[0],i=n[1],o=n[2],a=n[3],u=n[4],f=n[5],c=n[6],s=n[7],h=n[8],l=n[9],v=n[10],p=n[11],M=n[12],d=n[13],_=n[14],m=n[15],x=r[0],w=r[1],y=r[2],b=r[3];return t[0]=x*e+w*u+y*h+b*M,t[1]=x*i+w*f+y*l+b*d,t[2]=x*o+w*c+y*v+b*_,t[3]=x*a+w*s+y*p+b*m,x=r[4],w=r[5],y=r[6],b=r[7],t[4]=x*e+w*u+y*h+b*M,t[5]=x*i+w*f+y*l+b*d,t[6]=x*o+w*c+y*v+b*_,t[7]=x*a+w*s+y*p+b*m,x=r[8],w=r[9],y=r[10],b=r[11],t[8]=x*e+w*u+y*h+b*M,t[9]=x*i+w*f+y*l+b*d,t[10]=x*o+w*c+y*v+b*_,t[11]=x*a+w*s+y*p+b*m,x=r[12],w=r[13],y=r[14],b=r[15],t[12]=x*e+w*u+y*h+b*M,t[13]=x*i+w*f+y*l+b*d,t[14]=x*o+w*c+y*v+b*_,t[15]=x*a+w*s+y*p+b*m,t}function Z(t,n,r){var e,i,o,a,u,f,c,s,h,l,v,p,M=r[0],d=r[1],_=r[2];return n===t?(t[12]=n[0]*M+n[4]*d+n[8]*_+n[12],t[13]=n[1]*M+n[5]*d+n[9]*_+n[13],t[14]=n[2]*M+n[6]*d+n[10]*_+n[14],t[15]=n[3]*M+n[7]*d+n[11]*_+n[15]):(e=n[0],i=n[1],o=n[2],a=n[3],u=n[4],f=n[5],c=n[6],s=n[7],h=n[8],l=n[9],v=n[10],p=n[11],t[0]=e,t[1]=i,t[2]=o,t[3]=a,t[4]=u,t[5]=f,t[6]=c,t[7]=s,t[8]=h,t[9]=l,t[10]=v,t[11]=p,t[12]=e*M+u*d+h*_+n[12],t[13]=i*M+f*d+l*_+n[13],t[14]=o*M+c*d+v*_+n[14],t[15]=a*M+s*d+p*_+n[15]),t}function $(t,n,r){var e=r[0],i=r[1],o=r[2];return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=n[7]*i,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=n[11]*o,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function tt(t,n,r,e){var i,o,u,f,c,s,h,l,v,p,M,d,_,m,x,w,y,b,g,S,O,C,T,P,E=e[0],I=e[1],A=e[2],D=Math.sqrt(E*E+I*I+A*A);return D<a?null:(E*=D=1/D,I*=D,A*=D,i=Math.sin(r),u=1-(o=Math.cos(r)),f=n[0],c=n[1],s=n[2],h=n[3],l=n[4],v=n[5],p=n[6],M=n[7],d=n[8],_=n[9],m=n[10],x=n[11],w=E*E*u+o,y=I*E*u+A*i,b=A*E*u-I*i,g=E*I*u-A*i,S=I*I*u+o,O=A*I*u+E*i,C=E*A*u+I*i,T=I*A*u-E*i,P=A*A*u+o,t[0]=f*w+l*y+d*b,t[1]=c*w+v*y+_*b,t[2]=s*w+p*y+m*b,t[3]=h*w+M*y+x*b,t[4]=f*g+l*S+d*O,t[5]=c*g+v*S+_*O,t[6]=s*g+p*S+m*O,t[7]=h*g+M*S+x*O,t[8]=f*C+l*T+d*P,t[9]=c*C+v*T+_*P,t[10]=s*C+p*T+m*P,t[11]=h*C+M*T+x*P,n!==t&&(t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t)}function nt(t,n,r){var e=Math.sin(r),i=Math.cos(r),o=n[4],a=n[5],u=n[6],f=n[7],c=n[8],s=n[9],h=n[10],l=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=o*i+c*e,t[5]=a*i+s*e,t[6]=u*i+h*e,t[7]=f*i+l*e,t[8]=c*i-o*e,t[9]=s*i-a*e,t[10]=h*i-u*e,t[11]=l*i-f*e,t}function rt(t,n,r){var e=Math.sin(r),i=Math.cos(r),o=n[0],a=n[1],u=n[2],f=n[3],c=n[8],s=n[9],h=n[10],l=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=o*i-c*e,t[1]=a*i-s*e,t[2]=u*i-h*e,t[3]=f*i-l*e,t[8]=o*e+c*i,t[9]=a*e+s*i,t[10]=u*e+h*i,t[11]=f*e+l*i,t}function et(t,n,r){var e=Math.sin(r),i=Math.cos(r),o=n[0],a=n[1],u=n[2],f=n[3],c=n[4],s=n[5],h=n[6],l=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=o*i+c*e,t[1]=a*i+s*e,t[2]=u*i+h*e,t[3]=f*i+l*e,t[4]=c*i-o*e,t[5]=s*i-a*e,t[6]=h*i-u*e,t[7]=l*i-f*e,t}function it(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function ot(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function at(t,n,r){var e,i,o,u=r[0],f=r[1],c=r[2],s=Math.sqrt(u*u+f*f+c*c);return s<a?null:(u*=s=1/s,f*=s,c*=s,e=Math.sin(n),o=1-(i=Math.cos(n)),t[0]=u*u*o+i,t[1]=f*u*o+c*e,t[2]=c*u*o-f*e,t[3]=0,t[4]=u*f*o-c*e,t[5]=f*f*o+i,t[6]=c*f*o+u*e,t[7]=0,t[8]=u*c*o+f*e,t[9]=f*c*o-u*e,t[10]=c*c*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function ut(t,n){var r=Math.sin(n),e=Math.cos(n);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ft(t,n){var r=Math.sin(n),e=Math.cos(n);return t[0]=e,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ct(t,n){var r=Math.sin(n),e=Math.cos(n);return t[0]=e,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=e,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function st(t,n,r){var e=n[0],i=n[1],o=n[2],a=n[3],u=e+e,f=i+i,c=o+o,s=e*u,h=e*f,l=e*c,v=i*f,p=i*c,M=o*c,d=a*u,_=a*f,m=a*c;return t[0]=1-(v+M),t[1]=h+m,t[2]=l-_,t[3]=0,t[4]=h-m,t[5]=1-(s+M),t[6]=p+d,t[7]=0,t[8]=l+_,t[9]=p-d,t[10]=1-(s+v),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function ht(t,n){var r=new u(3),e=-n[0],i=-n[1],o=-n[2],a=n[3],f=n[4],c=n[5],s=n[6],h=n[7],l=e*e+i*i+o*o+a*a;return l>0?(r[0]=2*(f*a+h*e+c*o-s*i)/l,r[1]=2*(c*a+h*i+s*e-f*o)/l,r[2]=2*(s*a+h*o+f*i-c*e)/l):(r[0]=2*(f*a+h*e+c*o-s*i),r[1]=2*(c*a+h*i+s*e-f*o),r[2]=2*(s*a+h*o+f*i-c*e)),st(t,n,r),t}function lt(t,n){return t[0]=n[12],t[1]=n[13],t[2]=n[14],t}function vt(t,n){var r=n[0],e=n[1],i=n[2],o=n[4],a=n[5],u=n[6],f=n[8],c=n[9],s=n[10];return t[0]=Math.sqrt(r*r+e*e+i*i),t[1]=Math.sqrt(o*o+a*a+u*u),t[2]=Math.sqrt(f*f+c*c+s*s),t}function pt(t,n){var r=n[0]+n[5]+n[10],e=0;return r>0?(e=2*Math.sqrt(r+1),t[3]=.25*e,t[0]=(n[6]-n[9])/e,t[1]=(n[8]-n[2])/e,t[2]=(n[1]-n[4])/e):n[0]>n[5]&&n[0]>n[10]?(e=2*Math.sqrt(1+n[0]-n[5]-n[10]),t[3]=(n[6]-n[9])/e,t[0]=.25*e,t[1]=(n[1]+n[4])/e,t[2]=(n[8]+n[2])/e):n[5]>n[10]?(e=2*Math.sqrt(1+n[5]-n[0]-n[10]),t[3]=(n[8]-n[2])/e,t[0]=(n[1]+n[4])/e,t[1]=.25*e,t[2]=(n[6]+n[9])/e):(e=2*Math.sqrt(1+n[10]-n[0]-n[5]),t[3]=(n[1]-n[4])/e,t[0]=(n[8]+n[2])/e,t[1]=(n[6]+n[9])/e,t[2]=.25*e),t}function Mt(t,n,r,e){var i=n[0],o=n[1],a=n[2],u=n[3],f=i+i,c=o+o,s=a+a,h=i*f,l=i*c,v=i*s,p=o*c,M=o*s,d=a*s,_=u*f,m=u*c,x=u*s,w=e[0],y=e[1],b=e[2];return t[0]=(1-(p+d))*w,t[1]=(l+x)*w,t[2]=(v-m)*w,t[3]=0,t[4]=(l-x)*y,t[5]=(1-(h+d))*y,t[6]=(M+_)*y,t[7]=0,t[8]=(v+m)*b,t[9]=(M-_)*b,t[10]=(1-(h+p))*b,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function dt(t,n,r,e,i){var o=n[0],a=n[1],u=n[2],f=n[3],c=o+o,s=a+a,h=u+u,l=o*c,v=o*s,p=o*h,M=a*s,d=a*h,_=u*h,m=f*c,x=f*s,w=f*h,y=e[0],b=e[1],g=e[2],S=i[0],O=i[1],C=i[2],T=(1-(M+_))*y,P=(v+w)*y,E=(p-x)*y,I=(v-w)*b,A=(1-(l+_))*b,D=(d+m)*b,z=(p+x)*g,j=(d-m)*g,B=(1-(l+M))*g;return t[0]=T,t[1]=P,t[2]=E,t[3]=0,t[4]=I,t[5]=A,t[6]=D,t[7]=0,t[8]=z,t[9]=j,t[10]=B,t[11]=0,t[12]=r[0]+S-(T*S+I*O+z*C),t[13]=r[1]+O-(P*S+A*O+j*C),t[14]=r[2]+C-(E*S+D*O+B*C),t[15]=1,t}function _t(t,n){var r=n[0],e=n[1],i=n[2],o=n[3],a=r+r,u=e+e,f=i+i,c=r*a,s=e*a,h=e*u,l=i*a,v=i*u,p=i*f,M=o*a,d=o*u,_=o*f;return t[0]=1-h-p,t[1]=s+_,t[2]=l-d,t[3]=0,t[4]=s-_,t[5]=1-c-p,t[6]=v+M,t[7]=0,t[8]=l+d,t[9]=v-M,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function mt(t,n,r,e,i,o,a){var u=1/(r-n),f=1/(i-e),c=1/(o-a);return t[0]=2*o*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*f,t[6]=0,t[7]=0,t[8]=(r+n)*u,t[9]=(i+e)*f,t[10]=(a+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*c,t[15]=0,t}function xt(t,n,r,e,i){var o,a=1/Math.tan(n/2);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(e-i),t[10]=(i+e)*o,t[14]=2*i*e*o):(t[10]=-1,t[14]=-2*e),t}function wt(t,n,r,e){var i=Math.tan(n.upDegrees*Math.PI/180),o=Math.tan(n.downDegrees*Math.PI/180),a=Math.tan(n.leftDegrees*Math.PI/180),u=Math.tan(n.rightDegrees*Math.PI/180),f=2/(a+u),c=2/(i+o);return t[0]=f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(a-u)*f*.5,t[9]=(i-o)*c*.5,t[10]=e/(r-e),t[11]=-1,t[12]=0,t[13]=0,t[14]=e*r/(r-e),t[15]=0,t}function yt(t,n,r,e,i,o,a){var u=1/(n-r),f=1/(e-i),c=1/(o-a);return t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(n+r)*u,t[13]=(i+e)*f,t[14]=(a+o)*c,t[15]=1,t}function bt(t,n,r,e){var i,o,u,f,c,s,h,l,v,p,M=n[0],d=n[1],_=n[2],m=e[0],x=e[1],w=e[2],y=r[0],b=r[1],g=r[2];return Math.abs(M-y)<a&&Math.abs(d-b)<a&&Math.abs(_-g)<a?K(t):(h=M-y,l=d-b,v=_-g,i=x*(v*=p=1/Math.sqrt(h*h+l*l+v*v))-w*(l*=p),o=w*(h*=p)-m*v,u=m*l-x*h,(p=Math.sqrt(i*i+o*o+u*u))?(i*=p=1/p,o*=p,u*=p):(i=0,o=0,u=0),f=l*u-v*o,c=v*i-h*u,s=h*o-l*i,(p=Math.sqrt(f*f+c*c+s*s))?(f*=p=1/p,c*=p,s*=p):(f=0,c=0,s=0),t[0]=i,t[1]=f,t[2]=h,t[3]=0,t[4]=o,t[5]=c,t[6]=l,t[7]=0,t[8]=u,t[9]=s,t[10]=v,t[11]=0,t[12]=-(i*M+o*d+u*_),t[13]=-(f*M+c*d+s*_),t[14]=-(h*M+l*d+v*_),t[15]=1,t)}function gt(t,n,r,e){var i=n[0],o=n[1],a=n[2],u=e[0],f=e[1],c=e[2],s=i-r[0],h=o-r[1],l=a-r[2],v=s*s+h*h+l*l;v>0&&(s*=v=1/Math.sqrt(v),h*=v,l*=v);var p=f*l-c*h,M=c*s-u*l,d=u*h-f*s;return(v=p*p+M*M+d*d)>0&&(p*=v=1/Math.sqrt(v),M*=v,d*=v),t[0]=p,t[1]=M,t[2]=d,t[3]=0,t[4]=h*d-l*M,t[5]=l*p-s*d,t[6]=s*M-h*p,t[7]=0,t[8]=s,t[9]=h,t[10]=l,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function St(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Ot(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))}function Ct(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t[2]=n[2]+r[2],t[3]=n[3]+r[3],t[4]=n[4]+r[4],t[5]=n[5]+r[5],t[6]=n[6]+r[6],t[7]=n[7]+r[7],t[8]=n[8]+r[8],t[9]=n[9]+r[9],t[10]=n[10]+r[10],t[11]=n[11]+r[11],t[12]=n[12]+r[12],t[13]=n[13]+r[13],t[14]=n[14]+r[14],t[15]=n[15]+r[15],t}function Tt(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t[2]=n[2]-r[2],t[3]=n[3]-r[3],t[4]=n[4]-r[4],t[5]=n[5]-r[5],t[6]=n[6]-r[6],t[7]=n[7]-r[7],t[8]=n[8]-r[8],t[9]=n[9]-r[9],t[10]=n[10]-r[10],t[11]=n[11]-r[11],t[12]=n[12]-r[12],t[13]=n[13]-r[13],t[14]=n[14]-r[14],t[15]=n[15]-r[15],t}function Pt(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=n[7]*r,t[8]=n[8]*r,t[9]=n[9]*r,t[10]=n[10]*r,t[11]=n[11]*r,t[12]=n[12]*r,t[13]=n[13]*r,t[14]=n[14]*r,t[15]=n[15]*r,t}function Et(t,n,r,e){return t[0]=n[0]+r[0]*e,t[1]=n[1]+r[1]*e,t[2]=n[2]+r[2]*e,t[3]=n[3]+r[3]*e,t[4]=n[4]+r[4]*e,t[5]=n[5]+r[5]*e,t[6]=n[6]+r[6]*e,t[7]=n[7]+r[7]*e,t[8]=n[8]+r[8]*e,t[9]=n[9]+r[9]*e,t[10]=n[10]+r[10]*e,t[11]=n[11]+r[11]*e,t[12]=n[12]+r[12]*e,t[13]=n[13]+r[13]*e,t[14]=n[14]+r[14]*e,t[15]=n[15]+r[15]*e,t}function It(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[11]===n[11]&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[15]===n[15]}function At(t,n){var r=t[0],e=t[1],i=t[2],o=t[3],u=t[4],f=t[5],c=t[6],s=t[7],h=t[8],l=t[9],v=t[10],p=t[11],M=t[12],d=t[13],_=t[14],m=t[15],x=n[0],w=n[1],y=n[2],b=n[3],g=n[4],S=n[5],O=n[6],C=n[7],T=n[8],P=n[9],E=n[10],I=n[11],A=n[12],D=n[13],z=n[14],j=n[15];return Math.abs(r-x)<=a*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(e-w)<=a*Math.max(1,Math.abs(e),Math.abs(w))&&Math.abs(i-y)<=a*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(o-b)<=a*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(u-g)<=a*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(f-S)<=a*Math.max(1,Math.abs(f),Math.abs(S))&&Math.abs(c-O)<=a*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(s-C)<=a*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(h-T)<=a*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(l-P)<=a*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(v-E)<=a*Math.max(1,Math.abs(v),Math.abs(E))&&Math.abs(p-I)<=a*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(M-A)<=a*Math.max(1,Math.abs(M),Math.abs(A))&&Math.abs(d-D)<=a*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(_-z)<=a*Math.max(1,Math.abs(_),Math.abs(z))&&Math.abs(m-j)<=a*Math.max(1,Math.abs(m),Math.abs(j))}var Dt=Q,zt=Tt;function jt(){var t=new u(2);return u!=Float32Array&&(t[0]=0,t[1]=0),t}function Bt(t){var n=new u(2);return n[0]=t[0],n[1]=t[1],n}function kt(t,n){var r=new u(2);return r[0]=t,r[1]=n,r}function Lt(t,n){return t[0]=n[0],t[1]=n[1],t}function Ut(t,n,r){return t[0]=n,t[1]=r,t}function Ft(t,n,r){return t[0]=n[0]+r[0],t[1]=n[1]+r[1],t}function Nt(t,n,r){return t[0]=n[0]-r[0],t[1]=n[1]-r[1],t}function Vt(t,n,r){return t[0]=n[0]*r[0],t[1]=n[1]*r[1],t}function qt(t,n,r){return t[0]=n[0]/r[0],t[1]=n[1]/r[1],t}function Rt(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t}function Wt(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t}function Xt(t,n,r){return t[0]=Math.min(n[0],r[0]),t[1]=Math.min(n[1],r[1]),t}function Kt(t,n,r){return t[0]=Math.max(n[0],r[0]),t[1]=Math.max(n[1],r[1]),t}function Yt(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t}function Gt(t,n,r){return t[0]=n[0]*r,t[1]=n[1]*r,t}function Ht(t,n,r,e){return t[0]=n[0]+r[0]*e,t[1]=n[1]+r[1]*e,t}function Jt(t,n){var r=n[0]-t[0],e=n[1]-t[1];return Math.sqrt(r*r+e*e)}function Qt(t,n){var r=n[0]-t[0],e=n[1]-t[1];return r*r+e*e}function Zt(t){var n=t[0],r=t[1];return Math.sqrt(n*n+r*r)}function $t(t){var n=t[0],r=t[1];return n*n+r*r}function tn(t,n){return t[0]=-n[0],t[1]=-n[1],t}function nn(t,n){return t[0]=1/n[0],t[1]=1/n[1],t}function rn(t,n){var r=n[0],e=n[1],i=r*r+e*e;return i>0&&(i=1/Math.sqrt(i)),t[0]=n[0]*i,t[1]=n[1]*i,t}function en(t,n){return t[0]*n[0]+t[1]*n[1]}function on(t,n,r){var e=n[0]*r[1]-n[1]*r[0];return t[0]=t[1]=0,t[2]=e,t}function an(t,n,r,e){var i=n[0],o=n[1];return t[0]=i+e*(r[0]-i),t[1]=o+e*(r[1]-o),t}function un(t,n){n=n||1;var r=2*f()*Math.PI;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t}function fn(t,n,r){var e=n[0],i=n[1];return t[0]=r[0]*e+r[2]*i,t[1]=r[1]*e+r[3]*i,t}function cn(t,n,r){var e=n[0],i=n[1];return t[0]=r[0]*e+r[2]*i+r[4],t[1]=r[1]*e+r[3]*i+r[5],t}function sn(t,n,r){var e=n[0],i=n[1];return t[0]=r[0]*e+r[3]*i+r[6],t[1]=r[1]*e+r[4]*i+r[7],t}function hn(t,n,r){var e=n[0],i=n[1];return t[0]=r[0]*e+r[4]*i+r[12],t[1]=r[1]*e+r[5]*i+r[13],t}function ln(t,n,r,e){var i=n[0]-r[0],o=n[1]-r[1],a=Math.sin(e),u=Math.cos(e);return t[0]=i*u-o*a+r[0],t[1]=i*a+o*u+r[1],t}function vn(t,n){var r=t[0],e=t[1],i=n[0],o=n[1],a=r*r+e*e;a>0&&(a=1/Math.sqrt(a));var u=i*i+o*o;u>0&&(u=1/Math.sqrt(u));var f=(r*i+e*o)*a*u;return f>1?0:f<-1?Math.PI:Math.acos(f)}function pn(t){return t[0]=0,t[1]=0,t}function Mn(t){return"vec2("+t[0]+", "+t[1]+")"}function dn(t,n){return t[0]===n[0]&&t[1]===n[1]}function _n(t,n){var r=t[0],e=t[1],i=n[0],o=n[1];return Math.abs(r-i)<=a*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(e-o)<=a*Math.max(1,Math.abs(e),Math.abs(o))}var mn,xn=Zt,wn=Nt,yn=Vt,bn=qt,gn=Jt,Sn=Qt,On=$t,Cn=(mn=jt(),function(t,n,r,e,i,o){var a,u;for(n||(n=2),r||(r=0),u=e?Math.min(e*n+r,t.length):t.length,a=r;a<u;a+=n)mn[0]=t[a],mn[1]=t[a+1],i(mn,mn,o),t[a]=mn[0],t[a+1]=mn[1];return t});r.d(n,"a",function(){return e}),r.d(n,"b",function(){return i}),r.d(n,"c",function(){return o})},function(t,n,r){"use strict";var e=null,i=null,o=function(){return function(t,n){this.texture=t,this.width=n.width,this.height=n.height}}();function a(t,n,r){var e=t.createShader(n);return t.shaderSource(e,r),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS)?e:(alert("An error occurred compiling the shaders: "+t.getShaderInfoLog(e)),t.deleteShader(e),null)}function u(t,n,r){var e=a(t,t.VERTEX_SHADER,n),i=a(t,t.FRAGMENT_SHADER,r),o=t.createProgram();return t.attachShader(o,e),t.attachShader(o,i),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)?o:(alert("Unable to initialize the shader program: "+t.getProgramInfoLog(o)),null)}function f(t,n){var r=t.createTexture(),e=new Image;return t.bindTexture(t.TEXTURE_2D,r),new Promise(function(i){e.onload=function(){return t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),i(new o(r,e))},e.src=n})}function c(t){return t.createBuffer()}function s(t,n){i||(i=t.createFramebuffer()),n?(t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)):t.bindFramebuffer(t.FRAMEBUFFER,null)}function h(t,n,r,e,i,o){var a=new Uint8Array(i*o*4);return s(t,n),t.readPixels(r,e,i,o,t.RGBA,t.UNSIGNED_BYTE,a),s(t,null),a}function l(t,n,r,e,i,o,a){t.bindTexture(t.TEXTURE_2D,n),t.texSubImage2D(t.TEXTURE_2D,0,r,e,i,o,t.RGBA,t.FLOAT,a)}function v(t,n){return[].concat.apply([],[t.slice(0,n),t.slice(n,2*n),t.slice(3*n,4*n),t.slice(0,1*n),t.slice(3*n,4*n),t.slice(2*n,3*n)])}var p=r(0),M=function(t,n){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var e,i,o=r.call(t),a=[];try{for(;(void 0===n||n-- >0)&&!(e=o.next()).done;)a.push(e.value)}catch(t){i={error:t}}finally{try{e&&!e.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},d=6,_=function(){function t(t,n){this.usedVertices=0,this.name=t,this.xyzp=new Float32Array(4*n),this.uv=new Float32Array(2*n),this.maxVertices=n}return Object.defineProperty(t.prototype,"firstSprite",{get:function(){return this.firstVertice/d},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstVertice",{get:function(){return this.maxVertices-this.usedVertices},enumerable:!0,configurable:!0}),t.prototype.getZOfObject=function(t){return this.xyzp[4*d*t+2]},t.prototype.sort=function(t){var n,r,e=this,i=(n=this.firstVertice/d,r=this.usedVertices/d,Array.from({length:r},function(t,r){return n+r}));i.sort(function(t,n){return e.getZOfObject(n)-e.getZOfObject(t)});for(var o=i.length,a=0;a<i.length;a++)if(this.getZOfObject(i[a])<=t){o=a;break}var u=this.xyzp.slice(),f=this.uv.slice(),c=this.firstSprite;for(a=0;a<i.length;a++)this.xyzp.set(u.subarray(4*d*i[a],4*d*(i[a]+1)),4*d*(a+c)),this.uv.set(f.subarray(2*d*i[a],2*d*(i[a]+1)),2*d*(a+c));return o},t.prototype.reset=function(){this.usedVertices=0},Object.defineProperty(t.prototype,"usedSprites",{get:function(){return this.usedVertices/d},enumerable:!0,configurable:!0}),t}();function m(t,n,r,e,i){var o,a;return void 0===i&&(i=!1),t=Math.max(0,Math.min(p.i,t)),r=Math.max(0,Math.min(p.i,r)),n=Math.max(0,Math.min(p.i,n)),e=Math.max(0,Math.min(p.i,e)),t>r&&(r=(o=M([t,r],2))[0],t=o[1]),n>e&&(e=(a=M([n,e],2))[0],n=a[1]),i?Math.ceil((r-t)/q)*Math.ceil((e-n)/q):(r-t)*(e-n)}function x(t,n,r,e){if(!(e<=r)){var i=t.M,o=t._,a=n.firstVertice;o.bindBuffer(o.ARRAY_BUFFER,i.glBuffers.xyzp),o.bufferData(o.ARRAY_BUFFER,n.xyzp.subarray(4*a),o.STREAM_DRAW),o.bindBuffer(o.ARRAY_BUFFER,i.glBuffers.uv),o.bufferData(o.ARRAY_BUFFER,n.uv.subarray(2*a),o.STREAM_DRAW),o.useProgram(i.program);var u=o.FLOAT,f=!1,c=0,s=0;o.bindBuffer(o.ARRAY_BUFFER,i.glBuffers.xyzp),o.vertexAttribPointer(i.attribLocations.xyzp,4,u,f,c,s),o.enableVertexAttribArray(i.attribLocations.xyzp);u=o.FLOAT,f=!1,c=0,s=0;o.bindBuffer(o.ARRAY_BUFFER,i.glBuffers.uv),o.vertexAttribPointer(i.attribLocations.uv,2,u,f,c,s),o.enableVertexAttribArray(i.attribLocations.uv),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,t.S),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,t.O),o.activeTexture(o.TEXTURE3),o.bindTexture(o.TEXTURE_2D,t.C),o.uniform1i(i.uniformLocations.uSamplerSprites,0),o.uniform1i(i.uniformLocations.uSamplerPalettes,1),o.uniform1i(i.uniformLocations.uSamplerOthers,3),o.uniformMatrix4fv(i.uniformLocations.projectionMatrix,!1,t.T),o.uniformMatrix3fv(i.uniformLocations.modelViewMatrix,!1,t.P),o.uniform4f(i.uniformLocations.envColor,p.o[0],p.o[1],p.o[2],p.o[3]),o.uniform4f(i.uniformLocations.colorSwaps,p.l[0],p.l[1],p.l[2],p.l[3]),o.drawArrays(o.TRIANGLES,r*d,(e-r)*d)}}function w(t,n,r,e,i,o,a,u,f,c,s,h,l,_){var m,x;if(void 0===h&&(h=0),void 0===l&&(l=!1),void 0===_&&(_=!1),s&&(c|=p.f),t.usedVertices>=t.maxVertices)F&&console.log(t.name+" overuse (max "+t.maxVertices/d+"), ignoring drawOBJ");else{t.usedVertices+=d;var w=t.firstVertice;l&&(o=(m=M([u,o],2))[0],u=m[1]),_&&(a=(x=M([f,a],2))[0],f=x[1]),t.xyzp.set(v([n,r,h,c,e,r,h,c,n,i,h,c,e,i,h,c],4),4*w),t.uv.set(v([o,a,u,a,o,f,u,f],2),2*w)}}function y(t,n){return new _(t,n*d)}var b=6,g=function(){function t(t,n){this.usedVertices=0,this.name=t,this.xyzp=new Float32Array(4*n),this.mapInfo1=new Float32Array(4*n),this.mapInfo2=new Float32Array(4*n),this.mapInfo3=new Float32Array(4*n),this.mapInfo4=new Float32Array(4*n),this.maxVertices=n}return Object.defineProperty(t.prototype,"firstVertice",{get:function(){return this.maxVertices-this.usedVertices},enumerable:!0,configurable:!0}),t.prototype.getZOfBG=function(t){return this.xyzp[this.firstVertice+4*b*t+2]},t.prototype.reset=function(){this.usedVertices=0},Object.defineProperty(t.prototype,"usedLayers",{get:function(){return this.usedVertices/b},enumerable:!0,configurable:!0}),t}();function S(t,n){if(!(n.usedVertices<3)){var r=t._,e=t.I,i=n.firstVertice;r.bindBuffer(r.ARRAY_BUFFER,e.glBuffers.xyzp),r.bufferData(r.ARRAY_BUFFER,n.xyzp.subarray(4*i),r.STREAM_DRAW),r.bindBuffer(r.ARRAY_BUFFER,e.glBuffers.mapInfo1),r.bufferData(r.ARRAY_BUFFER,n.mapInfo1.subarray(4*i),r.STREAM_DRAW),r.bindBuffer(r.ARRAY_BUFFER,e.glBuffers.mapInfo2),r.bufferData(r.ARRAY_BUFFER,n.mapInfo2.subarray(4*i),r.STREAM_DRAW),r.bindBuffer(r.ARRAY_BUFFER,e.glBuffers.mapInfo3),r.bufferData(r.ARRAY_BUFFER,n.mapInfo3.subarray(4*i),r.STREAM_DRAW),r.bindBuffer(r.ARRAY_BUFFER,e.glBuffers.mapInfo4),r.bufferData(r.ARRAY_BUFFER,n.mapInfo4.subarray(4*i),r.STREAM_DRAW),r.useProgram(e.program);var o=r.FLOAT,a=!1,u=0,f=0;r.bindBuffer(r.ARRAY_BUFFER,e.glBuffers.xyzp),r.vertexAttribPointer(e.attribLocations.xyzp,4,o,a,u,f),r.enableVertexAttribArray(e.attribLocations.xyzp);var c=4;o=r.FLOAT,a=!1,u=0,f=0;r.bindBuffer(r.ARRAY_BUFFER,e.glBuffers.mapInfo1),r.vertexAttribPointer(e.attribLocations.mapInfo1,c,o,a,u,f),r.enableVertexAttribArray(e.attribLocations.mapInfo1);c=4,o=r.FLOAT,a=!1,u=0,f=0;r.bindBuffer(r.ARRAY_BUFFER,e.glBuffers.mapInfo2),r.vertexAttribPointer(e.attribLocations.mapInfo2,c,o,a,u,f),r.enableVertexAttribArray(e.attribLocations.mapInfo2);c=4,o=r.FLOAT,a=!1,u=0,f=0;r.bindBuffer(r.ARRAY_BUFFER,e.glBuffers.mapInfo3),r.vertexAttribPointer(e.attribLocations.mapInfo3,c,o,a,u,f),r.enableVertexAttribArray(e.attribLocations.mapInfo3);c=4,o=r.FLOAT,a=!1,u=0,f=0;r.bindBuffer(r.ARRAY_BUFFER,e.glBuffers.mapInfo4),r.vertexAttribPointer(e.attribLocations.mapInfo4,c,o,a,u,f),r.enableVertexAttribArray(e.attribLocations.mapInfo4),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t.S),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,t.O),r.activeTexture(r.TEXTURE2),r.bindTexture(r.TEXTURE_2D,t.D),r.activeTexture(r.TEXTURE3),r.bindTexture(r.TEXTURE_2D,t.C),r.uniform1i(e.uniformLocations.uSamplerSprites,0),r.uniform1i(e.uniformLocations.uSamplerPalettes,1),r.uniform1i(e.uniformLocations.uSamplerMaps,2),r.uniform1i(e.uniformLocations.uSamplerOthers,3),r.uniformMatrix4fv(e.uniformLocations.projectionMatrix,!1,t.T),r.uniformMatrix3fv(e.uniformLocations.modelViewMatrix,!1,t.P),r.uniform4f(e.uniformLocations.envColor,p.o[0],p.o[1],p.o[2],p.o[3]),r.uniform4f(e.uniformLocations.colorSwaps,p.l[0],p.l[1],p.l[2],p.l[3]),r.drawArrays(r.TRIANGLES,0,n.usedVertices)}}function O(t,n){return new g(t,n*b)}function C(t,n,r,e,i,o,a,u,f){var c=t._,s=t.z,h=[n,r,e,r,n,i,e,i],l=[o,a,u,f,o,a,u,f,o,a,u,f,o,a,u,f];c.bindBuffer(c.ARRAY_BUFFER,s.glBuffers.xy),c.bufferData(c.ARRAY_BUFFER,new Float32Array(h),c.STREAM_DRAW),c.bindBuffer(c.ARRAY_BUFFER,s.glBuffers.color),c.bufferData(c.ARRAY_BUFFER,new Float32Array(l),c.STREAM_DRAW),c.useProgram(s.program);var v=c.FLOAT,M=!1,d=0,_=0;c.bindBuffer(c.ARRAY_BUFFER,s.glBuffers.xy),c.vertexAttribPointer(s.attribLocations.xy,2,v,M,d,_),c.enableVertexAttribArray(s.attribLocations.xy);v=c.FLOAT,M=!1,d=0,_=0;c.bindBuffer(c.ARRAY_BUFFER,s.glBuffers.color),c.vertexAttribPointer(s.attribLocations.color,4,v,M,d,_),c.enableVertexAttribArray(s.attribLocations.color),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,t.O),c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,t.C),c.uniform1i(s.uniformLocations.uSamplerPalettes,0),c.uniform1i(s.uniformLocations.uSamplerOthers,1),c.uniform4f(s.uniformLocations.colorSwaps,p.l[0],p.l[1],p.l[2],p.l[3]),c.uniformMatrix4fv(s.uniformLocations.projectionMatrix,!1,t.T),c.uniformMatrix3fv(s.uniformLocations.modelViewMatrix,!1,t.P);_=0;c.drawArrays(c.TRIANGLE_STRIP,_,4)}var T=function(){function t(t,n,r,e,i,o){this.x=t,this.y=n,this.w=r,this.h=e,this.designTileset=i,this.designPalette=o}return t.prototype.offset=function(t,n,r,e){return this.x+=t,this.y+=n,this.w=r,this.h=e,this},t}(),P=function(){function t(t,n,r){this.y=t,this.w=n,this.h=r}return t.prototype.offset=function(t,n,r){return this.y+=t,this.w=n,this.h=r,this},t}(),E=function(){function t(t,n,r,e,i,o,a,u){this.x=t,this.y=n,this.w=r,this.h=e,this.tw=i,this.th=o,this.hiColor=a,this.designPalette=u}return Object.defineProperty(t.prototype,"tiles",{get:function(){return Math.floor(this.w/this.tw)*Math.floor(this.h/this.th)},enumerable:!0,configurable:!0}),t.prototype.offset=function(t,n,r,e){return this.x+=t,this.y+=n,this.w=r,this.h=e,this},t.prototype.tile=function(t){t=Math.floor(t);var n=Math.floor(this.w/this.tw);if(this.w/this.tw!==n)throw new Error("Not a tileset (w="+this.w+", h="+this.h+", tw="+this.tw+")");var r=t%n,e=Math.floor(t/n);return this.offset(r*this.tw,e*this.th,this.tw,this.th)},t}(),I=function(){function t(t,n,r){this.array=t,this.width=n,this.height=r}return t.prototype.getElement=function(t,n){return this.array[this.width*Math.floor(n)+Math.floor(t)]},t.prototype.setElement=function(t,n,r){this.array[this.width*Math.floor(n)+Math.floor(t)]=r},t}(),A=r(1),D=function(){function t(t,n,r,e){this.posterizeToBpp=-1,this.buffer=t,this.width=n,this.height=r,this.pixelsPerTexel=e}return t.prototype.clone=function(){var n=new t(this.buffer.slice(0),this.width,this.height,this.pixelsPerTexel);return n.posterizeToBpp=this.posterizeToBpp,n},t.prototype.readToBuffer=function(t,n,r,e,i){if(typeof this.buffer!=typeof i)throw new Error("readFromShadowTexture: dest buffer must be of same type");for(var o=this.width*this.pixelsPerTexel,a=t+n*o,u=0,f=0;f<e;f++)i.set(this.buffer.subarray(a,a+r),u),a+=o,u+=r},t.prototype.setPosterization=function(t){if(this.buffer.constructor!==Uint32Array)throw new Error("Posterization only available for color buffers (32-bit)");this.posterizeToBpp=t},t.prototype.writeTo=function(t,n,r,e,i){if(typeof this.buffer!=typeof i)throw new Error("writeToShadowTexture: data must be of same type");for(var o=this.width*this.pixelsPerTexel,a=0,u=t+n*o,f=0;f<e;f++)this.buffer.set(i.subarray(a,a+r),u),a+=r,u+=o},t.prototype.syncToVramTexture=function(n,r,e,i,o,a){o=Math.ceil(o/this.pixelsPerTexel),e%this.pixelsPerTexel>0&&(o+=1),e=Math.floor(e/this.pixelsPerTexel);var u=new Uint32Array(o*a);if(new t(new Uint32Array(this.buffer.buffer),this.width,this.height,1).readToBuffer(e,i,o,a,u),this.posterizeToBpp>=1)for(var f=0;f<u.length;f++)u[f]=A.a.posterize(u[f],this.posterizeToBpp);n.bindTexture(n.TEXTURE_2D,r),n.texSubImage2D(n.TEXTURE_2D,0,e,i,o,a,n.RGBA,n.UNSIGNED_BYTE,new Uint8Array(u.buffer))},t}();var z=r(2);r.d(n,"b",function(){return F}),r.d(n,"e",function(){return q}),r.d(n,"a",function(){return U}),r.d(n,"d",function(){return Y}),r.d(n,"c",function(){return G}),r.d(n,"f",function(){return H});var j,B,k,L,U,F=!0,N=17,V=512,q=16,R=function(){return function(t,n,r,e){this.effect=t,this.operation=n,this.blendSrc=r,this.blendDst=e}}(),W=new R("none","add",0,0),X=new R("blend","add",0,0);function K(t){return z.a.fromValues(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],1)}!function(t){t[t.current=0]="current",t[t.rom=1]="rom",t[t.blank=2]="blank"}(U||(U={}));var Y=function(){function t(){this.U=-1,this.length=p.h,this.buffer=new Float32Array(8*this.length),this.resetAll()}return t.prototype.getLine=function(t){return this.F(t)},t.prototype.resetAll=function(){this.U=-1;for(var t=0;t<this.length;t++)this.resetLine(t)},t.prototype.resetLine=function(t){var n=z.a.create();z.a.identity(n),this.setLine(t,n)},t.prototype.rotateLine=function(t,n){var r=K(this.F(t));z.a.rotate(r,r,n),this.setLine(t,r)},t.prototype.scaleLine=function(t,n){if(!Array.isArray(n)||2!==n.length)throw new Error("Array should be [x, y]");var r=K(this.F(t));z.a.scale(r,r,n),this.setLine(t,r)},t.prototype.setAll=function(t){for(var n=0;n<this.length;n++)this.setLine(n,t)},t.prototype.setLine=function(t,n){if(t<0||t>=this.length)throw new Error("setLine: index "+t+" out of range");this.U=-1,this.buffer.set(n.subarray(0,8),8*t)},t.prototype.translateLine=function(t,n){if(!Array.isArray(n)||2!==n.length)throw new Error("Array should be [x, y]");var r=K(this.F(t));z.a.translate(r,r,n),this.setLine(t,r)},t.prototype.transformVector=function(t,n){if(!Array.isArray(n)||2!==n.length)throw new Error("Array should be [x, y]");var r=z.c.create(),e=K(this.F(t));return z.c.transformMat3(r,n,e),{x:r[0],y:r[1]}},t.prototype.transformVectorInverse=function(t,n){if(!Array.isArray(n)||2!==n.length)throw new Error("Array should be [x, y]");var r=z.c.create(),e=K(this.F(t));return z.a.invert(e,e),z.c.transformMat3(r,n,e),{x:r[0],y:r[1]}},t.prototype.F=function(t){if(t<0||t>=this.length)throw new Error("getLine: index "+t+" out of range");return K(this.buffer.subarray(8*t,8*t+8))},t}(),G=function(){function t(t,n){this.targetPaletteNumber=n,this.targetPaletteIndex=t,this.length=p.h,this.buffer=new Float32Array(4*this.length)}return t.prototype.setAll=function(t){for(var n=0;n<this.length;n++)this.setLine(n,t)},t.prototype.setLine=function(t,n){if(t<0||t>=this.length)throw new Error("setLine: index "+t+" out of range");var r=A.a.extract(n,L);this.buffer[4*t]=r.r/255,this.buffer[4*t+1]=r.g/255,this.buffer[4*t+2]=r.b/255},t}(),H=function(){function t(t,n,r){var i=this;this.N=0,this.V=new R("color","add",8947848,8947848),this.W=new R("color","add",8947848,8947848),this.X=O("Opaque BG [BG]",N),this.K=O("Transparent BG [TBG]",1),this.Y=y("Opaque sprites [OBJ0]",V),this.G=y("Transparent sprites [OBJ1]",V),this.H={peakOBJ:0,peakBG:0,peakVramWrites:0},this.J=!0,this.Q=0,this.Z=0,this.$=0,this.tt=0,this.skip=!1,this.vec2=z.c,this.mat3=z.a,this.LineColorArray=G,this.LineTransformationArray=Y,this.CopySource=U,this.color=A.a,this.nt(t),this.rt();var o=this._;window.fetch(n+"game.json").then(function(t){if(!t.ok)throw new Error("You need to build your project first; run `npm run convert-gfx`.");return t.json()}).then(function(t){if(i.et=t,L=i.it=t.info.paletteBpp||4,-1===[2,3,4,5,8].indexOf(i.it))throw new Error("Unsupported paletteBpp "+i.it);Promise.all([f(o,n+"sprites.png").then(function(t){i.S=t.texture,i.ot=function(t,n){var r=new Uint8Array(h(t,n.texture,0,0,n.width,n.height).buffer);return new D(r,n.width,n.height,4)}(o,t),i.at=i.ot.clone(),Object(p.t)(t.width,t.height)}),f(o,n+"palettes.png").then(function(t){if(256!==t.width&&16!==t.width||!(t.height<=256))throw new Error("Mismatch in texture size (max {16,256}x256");i.O=t.texture,i.ut=function(t,n){var r=new Uint32Array(h(t,n.texture,0,0,n.width,n.height).buffer);return new D(r,n.width,n.height,1)}(o,t),i.ft=i.ut.clone(),8!==i.it&&i.ft.setPosterization(i.it),Object(p.r)(t.width,t.height)}),f(o,n+"maps.png").then(function(t){i.D=t.texture,i.ct=function(t,n){var r=new Uint16Array(h(t,n.texture,0,0,n.width,n.height).buffer);return new D(r,n.width,n.height,2)}(o,t),i.st=i.ct.clone(),Object(p.q)(t.width,t.height)})]).then(function(){i.C=function(t,n,r){e||(e=t.getExtension("OES_texture_float"));var i=t.createTexture(),o=new Float32Array(n*r*4);return o.fill(0),t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,r,0,t.RGBA,t.FLOAT,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),i}(o,p.e,p.d),i.configDisplay({extraSprites:!1}),function(t){var n=t._,r=u(n,"attribute vec4 aXyzp;\nattribute vec4 aMapInfo1;\nattribute vec4 aMapInfo2;\nattribute vec4 aMapInfo3;\nattribute vec4 aMapInfo4;\nuniform mat3 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying float vPaletteNo;\n// TODO Florian -- use vec4 and extract in fragment program\nvarying highp vec2 vMapStart;\nvarying highp vec2 vMapSize;\nvarying vec2 vTilesetStart;\nvarying float vTilesetWidth, vScrollY;\nvarying vec2 vTileSize;\nvarying mat3 vTransformationMatrix;\n// [0] = linescroll buffer, if 0 use vTransformationMatrix always, [1] = whether to wrap around\nvarying vec2 vOtherInfo;\n\nuniform sampler2D uSamplerMaps, uSamplerSprites, uSamplerPalettes, uSamplerOthers;\n\nmat3 readLinescrollBuffer(int bufferNo, int horizOffset) {\n\tfloat vOfs = float(bufferNo) / "+p.d+".0;\n\tvec4 first = texture2D(uSamplerOthers, vec2(float(horizOffset) / "+p.e+".0, vOfs));\n\tvec4 second = texture2D(uSamplerOthers, vec2(float(horizOffset + 1) / "+p.e+".0, vOfs));\n\treturn mat3(\n\t\tfirst.xy, 0,\n\t\tvec2(first.a, second.r), 0,\n\t\tsecond.ba, 1.0);\n}\n\nvoid main(void) {\n\t// Only scale the final matrix (we can always say that the VDP supports fixed point math inside for matrix multiplication)\n\tgl_Position = uProjectionMatrix * vec4(floor(uModelViewMatrix * aXyzp.xyz), 1);\n\tvPaletteNo = floor(aXyzp.w);\n\tvMapStart = floor(aMapInfo1.xy);\n\tvTilesetStart = floor(aMapInfo1.zw);\n\tvMapSize = floor(aMapInfo2.xy);\n\tvTilesetWidth = floor(aMapInfo2.z);\n\tvScrollY = floor(aMapInfo2.w);\n\tvTileSize = floor(aMapInfo3.xy);\n\tvTextureCoord = floor(aMapInfo3.zw);\n\tvOtherInfo = floor(aMapInfo4.xy);\n\t// If 0-255, use one transformation map-wide from the first line, if -1 never use transformations\n\tif (aMapInfo4.x >= 0.0 && aMapInfo4.x < 256.0) {\n\t\tvTransformationMatrix = readLinescrollBuffer(0, int(aMapInfo4.x) * 2);\n\t} else {\n\t\tvTransformationMatrix = mat3(\n\t\t\t1, 0, 0,\n\t\t\t0, 1, 0,\n\t\t\t0, 0, 1);\n\t}\n}\n","precision highp float;\n\nvarying highp vec2 vTextureCoord;\nvarying highp float vPaletteNo;\nvarying highp vec2 vMapStart;\nvarying highp vec2 vMapSize;varying vec2 vTilesetStart;\nvarying float vTilesetWidth, vScrollY;\nvarying vec2 vTileSize;\nvarying mat3 vTransformationMatrix;\nvarying vec2 vOtherInfo;\n\nuniform mat3 uModelViewMatrix;\nuniform vec4 uEnvColor, uColorSwaps;\nuniform sampler2D uSamplerMaps, uSamplerSprites, uSamplerPalettes, uSamplerOthers;\n\nint intDiv(float x, float y) {\n\treturn int(floor(x / y));\n}float modI(float a,float b) {\n\tfloat m=a-floor((a+0.5)/b)*b;\n\treturn floor(m+0.5);\n}\n\nmat3 readLinescrollBuffer(int bufferNo, int horizOffset) {\n\tfloat vOfs = float(bufferNo) / "+p.d+".0;\n\tvec4 first = texture2D(uSamplerOthers, vec2(float(horizOffset) / "+p.e+".0, vOfs));\n\tvec4 second = texture2D(uSamplerOthers, vec2(float(horizOffset + 1) / "+p.e+".0, vOfs));\n\treturn mat3(\n\t\tfirst.r, first.g, 0,\n\t\tfirst.a, second.r, 0,\n\t\tsecond.b, second.a, 1);\n}\n\nint readMap(int x, int y) {\n\tx = int(modI(float(x), vMapSize.x) + vMapStart.x);\n\ty = int(modI(float(y), vMapSize.y) + vMapStart.y);\n\n\tint texelId = x / 2;\n\tint texelC = x - texelId * 2;\n\tvec4 read = texture2D(uSamplerMaps, vec2(float(texelId) / "+p.b+".0, float(y) / "+p.a+".0));\n\tif (texelC == 0) return int(read.r * 255.0) + int(read.g * 255.0) * 256;\n\treturn int(read.b * 255.0) + int(read.a * 255.0) * 256;\n}\n\nvec2 positionInTexture(int tileNo) {\n\tvec2 base = vTilesetStart;\n\tfloat rowNo = float(tileNo / int(vTilesetWidth));\n\tfloat colNo = modI(float(tileNo), vTilesetWidth);\n\treturn base + vec2(colNo * vTileSize.x, rowNo * vTileSize.y);\n}\n\n"+Object(p.n)()+"\n"+Object(p.m)()+"\n\nvoid main(void) {\n\tmat3 transformationMatrix;\tfloat lineNo = vTextureCoord.y, y = lineNo + vScrollY;\n\t// Per-line info\n\tif (vOtherInfo.x >= 256.0) {\t\ttransformationMatrix = readLinescrollBuffer(int(vOtherInfo.x) - 256, int(lineNo) * 2);\n\t}\n\telse {\n\t\ttransformationMatrix = vTransformationMatrix;\n\t}\n\n\tvec2 texCoord = floor((transformationMatrix * vec3(vTextureCoord.x, y, 1)).xy);\tif (vOtherInfo.y < 1.0) {\n\t\tif (texCoord.x < 0.0) texCoord.x = 0.0;\n\t\tif (texCoord.y < 0.0) texCoord.y = 0.0;\n\t\tif (texCoord.x >= vTileSize.x * vMapSize.x) texCoord.x = vTileSize.x * vMapSize.x - 1.0;\n\t\tif (texCoord.y >= vTileSize.y * vMapSize.y) texCoord.y = vTileSize.y * vMapSize.y - 1.0;\n\t}\n\n\tint mapX = intDiv(texCoord.x, vTileSize.x), mapY = intDiv(texCoord.y, vTileSize.y);\n\tfloat basePalette = vPaletteNo;\n\tif (vPaletteNo >= "+p.f+".0) {\n\t\tbasePalette -= "+p.f+".0;\n\t}\tint mapTileNo = readMap(mapX, mapY);\tint palOfs = mapTileNo / 8192;\n\tfloat paletteOffset = basePalette + float(palOfs);\n\tmapTileNo -= palOfs * 8192; int prioBit = mapTileNo / 4096;\n\tmapTileNo -= prioBit;\tvec2 offsetInTile = vec2(int(texCoord.x) - mapX * int(vTileSize.x), int(texCoord.y) - mapY * int(vTileSize.y));\n\tvec2 tilesetPos = positionInTexture(mapTileNo) + offsetInTile;\n\tfloat texel;\n\n\tif (vPaletteNo >= "+p.f+".0) {\n\t\ttexel = readTexel8(tilesetPos.x, tilesetPos.y);\n\t}\n\telse {\n\t\ttexel = readTexel4(tilesetPos.x, tilesetPos.y);\n\t}\n\n\tvec4 color = readPalette(texel, paletteOffset / "+p.g+".0);\n\tgl_FragColor = "+Object(p.p)("color")+";\n}");t.I={program:r,attribLocations:{xyzp:n.getAttribLocation(r,"aXyzp"),mapInfo1:n.getAttribLocation(r,"aMapInfo1"),mapInfo2:n.getAttribLocation(r,"aMapInfo2"),mapInfo3:n.getAttribLocation(r,"aMapInfo3"),mapInfo4:n.getAttribLocation(r,"aMapInfo4")},glBuffers:{xyzp:c(n),mapInfo1:c(n),mapInfo2:c(n),mapInfo3:c(n),mapInfo4:c(n)},uniformLocations:{colorSwaps:n.getUniformLocation(r,"uColorSwaps"),envColor:n.getUniformLocation(r,"uEnvColor"),projectionMatrix:n.getUniformLocation(r,"uProjectionMatrix"),modelViewMatrix:n.getUniformLocation(r,"uModelViewMatrix"),uSamplerMaps:n.getUniformLocation(r,"uSamplerMaps"),uSamplerSprites:n.getUniformLocation(r,"uSamplerSprites"),uSamplerPalettes:n.getUniformLocation(r,"uSamplerPalettes"),uSamplerOthers:n.getUniformLocation(r,"uSamplerOthers")}}}(i),function(t){var n=t._,r=u(n,"// The 3 first are the vertex position, the 4th is the palette ID\nattribute vec4 aXyzp;\n// The 2 first are the texture position\nattribute vec2 aUv;\n\nuniform mat3 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying highp vec2 vTextureCoord;\nvarying highp float vPaletteNo;\nuniform sampler2D uSamplerSprites, uSamplerPalettes;\n\nvoid main(void) {\n\t// Only scale the final matrix (we can always say that the VDP supports fixed point math inside for matrix multiplication)\n\tgl_Position = uProjectionMatrix * vec4(floor(uModelViewMatrix * vec3(aXyzp.xy, aXyzp.z)), 1);\n\tvPaletteNo = aXyzp.w;\n\tvTextureCoord = aUv;\n}","precision highp float;\n\nvarying highp vec2 vTextureCoord;\nvarying highp float vPaletteNo;\nuniform vec4 uEnvColor, uColorSwaps;\nuniform sampler2D uSamplerOthers, uSamplerSprites, uSamplerPalettes;\n\n"+Object(p.n)()+"\n"+Object(p.m)()+"\n\nvoid main(void) {\n\tfloat texel, palette;\n\tif (vPaletteNo >= "+p.f+".0) {\n\t\ttexel = readTexel8(vTextureCoord.x, vTextureCoord.y);\n\t\tpalette = (vPaletteNo - "+p.f+".0) / "+p.g+".0;\n\t}\n\telse {\n\t\ttexel = readTexel4(vTextureCoord.x, vTextureCoord.y);\n\t\tpalette = vPaletteNo / "+p.g+".0;\n\t}\n\n\tvec4 color = readPalette(texel, palette);\n\tgl_FragColor = "+Object(p.p)("color")+";\n}");t.M={program:r,attribLocations:{xyzp:n.getAttribLocation(r,"aXyzp"),uv:n.getAttribLocation(r,"aUv")},glBuffers:{xyzp:c(n),uv:c(n)},uniformLocations:{colorSwaps:n.getUniformLocation(r,"uColorSwaps"),envColor:n.getUniformLocation(r,"uEnvColor"),projectionMatrix:n.getUniformLocation(r,"uProjectionMatrix"),modelViewMatrix:n.getUniformLocation(r,"uModelViewMatrix"),uSamplerOthers:n.getUniformLocation(r,"uSamplerOthers"),uSamplerSprites:n.getUniformLocation(r,"uSamplerSprites"),uSamplerPalettes:n.getUniformLocation(r,"uSamplerPalettes")}}}(i),function(t){var n=t._,r=u(n,"\n\t\t\tattribute vec2 aXy;\n\t\t\tattribute vec4 aColor;\n\t\n\t\t\tuniform mat3 uModelViewMatrix;\n\t\t\tuniform mat4 uProjectionMatrix;\n\t\n\t\t\tvarying lowp vec4 vColor;\n\t\t\n\t\t\tvoid main(void) {\n\t\t\t\tvec4 pos = uProjectionMatrix * vec4(floor(uModelViewMatrix * vec3(aXy, 0)), 1);\n\t\t\t\tpos.z = 0.0;\n\t\t\t\tgl_Position = pos;\n\t\t\t\tvColor = aColor;\n\t\t\t}\n\t\t","precision highp float;\n    varying vec4 vColor;\n\t\tuniform vec4 uColorSwaps;\n\t\tuniform sampler2D uSamplerOthers, uSamplerPalettes;\n    \n    "+Object(p.m)(!1)+"\n\n    void main(void) {\n      if (vColor.a > 0.0) {\n\t      gl_FragColor = vColor;\n\t    } else {\n\t\t    vec4 color = readPalette(0.0, 0.0);\n\t\t\t\tgl_FragColor = vec4(color.rgb, 1.0);\n\t\t\t}\n    }\n  ");t.z={program:r,arrayBuffers:{xy:new Float32Array(8),color:new Float32Array(16)},attribLocations:{xy:n.getAttribLocation(r,"aXy"),color:n.getAttribLocation(r,"aColor")},glBuffers:{xy:c(n),color:c(n)},uniformLocations:{colorSwaps:n.getUniformLocation(r,"uColorSwaps"),projectionMatrix:n.getUniformLocation(r,"uProjectionMatrix"),modelViewMatrix:n.getUniformLocation(r,"uModelViewMatrix"),uSamplerOthers:n.getUniformLocation(r,"uSamplerOthers"),uSamplerPalettes:n.getUniformLocation(r,"uSamplerPalettes")}}}(i),r()})})}return t.prototype.configBackdropColor=function(t){var n=this.readPaletteMemory(0,0,1,1,U.blank);n.array[0]=A.a.make(t),this.writePaletteMemory(0,0,1,1,n)},t.prototype.configBackgroundTransparency=function(t){if("add"!==t.op&&"sub"!==t.op)throw new Error("Invalid operation "+t.op);this.V.operation=t.op,this.V.blendSrc=A.a.posterize(A.a.make(t.blendSrc),this.it),this.V.blendDst=A.a.posterize(A.a.make(t.blendDst),this.it)},t.prototype.configColorSwap=function(t){var n=this;if(t.length>4)throw new Error("Can only swap up to 4 colors at a time");t.forEach(function(t,r){p.l[r]=t.targetPaletteNumber<<8|t.targetPaletteIndex,l(n._,n.C,0,r+p.c,t.buffer.length/4,1,t.buffer)});for(var r=t.length;r<4;r++)p.l[r]=-1},t.prototype.configDisplay=function(t){if(void 0===t&&(t={}),this.$>0||this.Z>0)throw new Error("configDisplay must come at the beginning of your program/frame");j=(t.extraSprites?1:2)*this.screenWidth*this.screenHeight,k=t.extraSprites?512:256,B=(t.extraSprites?2:1)*Math.ceil(this.screenWidth*this.screenHeight/(q*q))},t.prototype.configFade=function(t){var n=t.color||0;t.factor=Math.min(255,Math.max(0,t.factor)),this.N=16777215&A.a.make(n)|t.factor<<24},t.prototype.configObjectTransparency=function(t){if("add"!==t.op&&"sub"!==t.op)throw new Error("Invalid operation "+t.op);this.W.operation=t.op,this.W.blendSrc=A.a.posterize(A.a.make(t.blendSrc),this.it),this.W.blendDst=A.a.posterize(A.a.make(t.blendDst),this.it)},t.prototype.drawBackgroundTilemap=function(t,n){void 0===n&&(n={}),"string"==typeof t&&(t=this.map(t));var r=this.ht(n.hasOwnProperty("palette")?n.palette:t.designPalette),e=this.lt(n.hasOwnProperty("tileset")?n.tileset:t.designTileset),i=n.hasOwnProperty("scrollX")?n.scrollX:0,o=n.hasOwnProperty("scrollY")?n.scrollY:0,a=n.hasOwnProperty("winX")?n.winX:0,u=n.hasOwnProperty("winY")?n.winY:0,f=n.hasOwnProperty("winW")?n.winW:p.i-a,c=n.hasOwnProperty("winH")?n.winH:p.h-u,s=!n.hasOwnProperty("wrap")||n.wrap,h=!!n.transparent,M=Math.floor(n.prio||(h?1:0)),d=h?this.K:this.X;if(M<0||M>15)throw new Error("Unsupported BG priority (0-15)");var _=m(a,u,a+f,u+c);if(_+this.Z>j)return F&&console.log("Using too many BG pixels"),void(this.Z=j);this.Z+=_;var x=-1;if(n.lineTransform&&(x=n.lineTransform.U)<0){if(this.Q>=2)return void(F&&console.log("Only 2 LineTransformationArray are allowed"));n.lineTransform.U=x=256+this.Q,l(this._,this.C,0,this.Q++,n.lineTransform.buffer.length/4,1,n.lineTransform.buffer)}!function(t,n,r,e,i,o,a,u,f,c,s,h,l,M,d,_,m,x,w,y,g){if(void 0===w&&(w=-1),void 0===y&&(y=1),void 0===g&&(g=0),d+=s,_+=h,u=Math.floor(u/f),x&&(m|=p.f),t.usedVertices>=t.maxVertices)F&&console.log(t.name+" overuse (max "+t.maxVertices/b+"), ignoring drawBackgroundTilemap");else{t.usedVertices+=b;var S=t.firstVertice;t.xyzp.set(v([s,h,g,m,s+l,h,g,m,s,h+M,g,m,s+l,h+M,g,m],4),4*S),t.mapInfo1.set(v([n,r,e,i,n,r,e,i,n,r,e,i,n,r,e,i],4),4*S),t.mapInfo2.set(v([o,a,u,_,o,a,u,_,o,a,u,_,o,a,u,_],4),4*S),t.mapInfo3.set(v([f,c,d,0,f,c,d+l,0,f,c,d,M,f,c,d+l,M],4),4*S),t.mapInfo4.set(v([w,y,0,0,w,y,0,0,w,y,0,0,w,y,0,0],4),4*S)}}(d,t.x,t.y,e.x,e.y,t.w,t.h,e.w,e.tw,e.th,a,u,f,c,i,o,r.y,e.hiColor,x,s?1:0,M)},t.prototype.drawObject=function(t,n,r,e){void 0===e&&(e={}),"string"==typeof t&&(t=this.sprite(t));var i=this.ht(e.hasOwnProperty("palette")?e.palette:t.designPalette),o=e.hasOwnProperty("width")?e.width:t.w,a=e.hasOwnProperty("height")?e.height:t.h,u=Math.floor(e.prio||(e.transparent?2:1)),f=e.transparent?this.G:this.Y,c=Math.floor(t.x),s=Math.floor(t.y);if(u<0||u>15)throw new Error("Unsupported object priority (0-15)");if(this.Y.usedSprites+this.G.usedSprites>=k)F&&console.log("Using too many objects (max "+k);else{var h=m(n,r,n+o,r+a,!0);if(h+this.$>B){if(F&&console.log("Using too many OBJ pixels"),this.$>=B)return;var l=m(0,r,q,r+a,!0),v=B-this.$,p=Math.floor(v/l)*q;return w(f,n,r,n+p,r+a,c,s,c+t.w*p/o,s+Math.floor(t.h),i.y,t.hiColor,u,e.flipH,e.flipV),void(this.$=B)}this.$+=h,w(f,n,r,n+o,r+a,c,s,c+Math.floor(t.w),s+Math.floor(t.h),i.y,t.hiColor,u,e.flipH,e.flipV)}},t.prototype.map=function(t){var n=this.et.maps[t];if(!n)throw new Error("Map "+t+" not found");return new T(n.x,n.y,n.w,n.h,n.til,n.pal)},t.prototype.palette=function(t){var n=this.et.pals[t];if(!n)throw new Error("Palette "+t+" not found");return new P(n.y,n.w,n.h)},t.prototype.readMap=function(t,n){void 0===n&&(n=U.current);var r=this.vt(t),e=new Uint16Array(r.w*r.h);return n===U.current&&this.st.readToBuffer(r.x,r.y,r.w,r.h,e),n===U.rom&&this.ct.readToBuffer(r.x,r.y,r.w,r.h,e),new I(e,r.w,r.h)},t.prototype.readObjectList=function(t,n){void 0===n&&(n=U.rom);for(var r=this.readMap(t,n).array,e=new Uint8Array(r.buffer),i="",o=0;o<e.length&&e[o]>0;o++)i+=String.fromCharCode(e[o]);try{return JSON.parse(i)}catch(t){return console.log("Parse error in JSON",t),[]}},t.prototype.readPalette=function(t,n){void 0===n&&(n=U.current);var r=this.ht(t);return this.readPaletteMemory(0,r.y,r.w,r.h,n)},t.prototype.readPaletteMemory=function(t,n,r,e,i){void 0===i&&(i=U.current);var o=new Uint32Array(r*e);return i===U.current&&this.ft.readToBuffer(t,n,r,e,o),i===U.rom&&this.ut.readToBuffer(t,n,r,e,o),new I(o,r,e)},t.prototype.readSprite=function(t,n){void 0===n&&(n=U.current);var r=this.lt(t);if(!r.hiColor&&r.x%2!=0)throw new Error("Lo-color sprites need to be aligned to 2 pixels");var e=r.hiColor?r.x:r.x/2,i=r.hiColor?r.w:Math.ceil(r.w/2),o=new Uint8Array(i*r.h);return n===U.current&&this.at.readToBuffer(e,r.y,i,r.h,o),n===U.rom&&this.ot.readToBuffer(e,r.y,i,r.h,o),new I(o,i,r.h)},Object.defineProperty(t.prototype,"screenHeight",{get:function(){return p.h},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"screenWidth",{get:function(){return p.i},enumerable:!0,configurable:!0}),t.prototype.sprite=function(t){var n=this.et.sprites[t];if(!n)throw new Error("Sprite "+t+" not found");return new E(n.x,n.y,n.w,n.h,n.tw,n.th,!!n.hicol,n.pal)},t.prototype.writeMap=function(t,n){var r=this.vt(t);this.st.writeTo(r.x,r.y,r.w,r.h,n.array),this.st.syncToVramTexture(this._,this.D,r.x,r.y,r.w,r.h),this.tt+=Math.max(16,r.w*r.h)},t.prototype.writePalette=function(t,n){var r=this.ht(t);this.writePaletteMemory(0,r.y,r.w,r.h,n)},t.prototype.writePaletteMemory=function(t,n,r,e,i){this.ft.writeTo(t,n,r,e,i.array),this.ft.syncToVramTexture(this._,this.O,t,n,r,e),this.tt+=Math.max(16,r*e)},t.prototype.writeSprite=function(t,n){var r=this.lt(t);if(!r.hiColor&&r.x%2!=0)throw new Error("Lo-color sprites need to be aligned to 2 pixels");var e=r.hiColor?r.x:r.x/2,i=r.hiColor?r.w:Math.ceil(r.w/2);this.at.writeTo(e,r.y,i,r.h,n.array),this.at.syncToVramTexture(this._,this.S,e,r.y,i,r.h),this.tt+=Math.max(16,i*r.h)},t.prototype.pt=function(t){var n=this._,r=t.effect,e=t.blendSrc,i=t.blendDst,o=t.operation;if(p.o[0]=p.o[1]=p.o[2]=p.o[3]=1,n.blendEquation("sub"===o?n.FUNC_REVERSE_SUBTRACT:n.FUNC_ADD),"blend"===r)n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA);else if("premult"===r)n.enable(n.BLEND),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA);else if("color"===r){var a=A.a.extract(i,this.it),u=A.a.extract(e,this.it);n.blendColor(a.r/255,a.g/255,a.b/255,a.a/255),p.o[0]=u.r/255,p.o[1]=u.g/255,p.o[2]=u.b/255,p.o[3]=u.a/255,n.blendFunc(n.SRC_ALPHA,n.CONSTANT_COLOR),n.enable(n.BLEND)}else n.disable(n.BLEND)},t.prototype.Mt=function(){this.H.peakBG=Math.max(this.H.peakBG,this.Z/(this.screenWidth*this.screenHeight)),this.H.peakOBJ=Math.max(this.H.peakOBJ,this.$)},t.prototype.dt=function(){var t=this._;if(F&&this.Mt(),!this.skip){this.J&&(t.clearColor(0,0,0,0),p.k?(t.clearDepth(1),t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT)):t.clear(t.COLOR_BUFFER_BIT),t.disable(t.DEPTH_TEST),C(this,0,0,p.i,p.h,0,0,0,0),this.J=!1,p.k&&(t.depthFunc(t.LESS),t.enable(t.DEPTH_TEST))),this.pt(W),S(this,this.X),x(this,this.Y,0,this.Y.usedSprites);var n=this.G.sort(this.K.getZOfBG(0));this.pt(this.W),x(this,this.G,0,n),this.pt(this.V),S(this,this.K),this.pt(this.W),x(this,this.G,n,this.G.usedSprites)}this.X.reset(),this.K.reset(),this.Y.reset(),this.G.reset(),this.Q=this.$=this.Z=0},t.prototype._t=function(){if(this.dt(),!this.skip){var t=A.a.extract(this.N,this.it),n=t.r,r=t.g,e=t.b,i=t.a;if(i>0){var o=this._;this.pt(X),o.disable(o.DEPTH_TEST),C(this,0,0,p.i,p.h,n/255,r/255,e/255,i/255)}}var a=Math.min(30,Math.ceil(this.tt/2048));return F&&a>1&&console.log("Overuse of VRAM writes for this frame ("+this.tt+"/2048), slowing down "+a+"x"),this.H.peakVramWrites=Math.max(this.H.peakVramWrites,this.tt),this.tt=0,a},t.prototype.vt=function(t){return"string"==typeof t?this.map(t):t},t.prototype.ht=function(t){return"string"==typeof t?this.palette(t):t},t.prototype.lt=function(t){return"string"==typeof t?this.sprite(t):t},t.prototype.mt=function(){var t=this.H;return this.H={peakOBJ:0,peakBG:0,peakVramWrites:0},t},t.prototype.nt=function(t){this._=t.getContext("webgl",{premultipliedAlpha:!0,alpha:p.j,antialias:!1}),null===this._&&alert("Unable to initialize WebGL. Your browser or machine may not support it.")},t.prototype.rt=function(){this.T=z.b.create(),z.b.ortho(this.T,0,p.i,p.h,0,-16,16),this.P=z.a.create()},t.prototype.xt=function(t){this.skip=t,this.J=!0},t}()},function(t,n,r){"use strict";var e,i,o=r(0),a=r(3),u=59.94,f=1/(u+1),c=1/u,s=1/(u-1),h=30,l=function(){function t(){this.last=0,this.late=0,this.framerateSum=c*h}return t.prototype.doForSmoothness=function(t){var n=this.wt(t);if(this.yt(n),n>s?(this.late+=n-s,this.late>.25&&(this.late=0)):n<f&&(this.late+=n-f),this.last=t,this.late<=-c)return this.late+=c,0;if(this.late>=c){var r=Math.floor(this.late/c);return this.late-=r*c,1+r}return 1},t.prototype.doSimplest=function(t){var n=this.wt(t);return this.yt(n),this.last=t,1},t.prototype.doStandard=function(t){var n=this.wt(t);if(this.yt(n),this.late+=n-c,this.late>.25&&(this.late=0),this.last=t,this.late>=c){var r=Math.floor(this.late/c);return this.late-=r*c,1+r}return this.late<=-c?(this.late+=c,0):1},t.prototype.getFramerate=function(){return h/this.framerateSum},t.prototype.yt=function(t){t<.25&&(this.framerateSum=this.framerateSum*(h-1)/h+t)},t.prototype.wt=function(t){return(t-this.last)/1e3},t}();!function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.A=4]="A",t[t.B=5]="B",t[t.L=6]="L",t[t.R=7]="R",t[t.Start=8]="Start",t[t.Select=9]="Select",t[t.NumKeys=10]="NumKeys"}(e||(e={})),function(t){t[t.Up=0]="Up",t[t.Released=1]="Released",t[t.Down=2]="Down",t[t.Pressed=3]="Pressed"}(i||(i={}));var v={arrowup:e.Up,arrowdown:e.Down,arrowleft:e.Left,arrowright:e.Right,w:e.Up,s:e.Down,a:e.Left,d:e.Right,j:e.A,k:e.B,h:e.L,l:e.R,c:e.A,v:e.B,x:e.L,b:e.R," ":e.Select,enter:e.Start},p=function(){function t(){this.Key=e;var t=this;this.keyState=new Array(e.NumKeys).fill(i.Up),document.onkeydown=function(n){var r=t.bt(n);r>=0&&!t.isDown(r)&&(t.keyState[r]=i.Pressed)},document.onkeyup=function(n){var r=t.bt(n);r>=0&&(t.keyState[r]=i.Released)}}return t.prototype.hasToggledDown=function(t){return this.keyState[t]===i.Pressed},t.prototype.hasToggledUp=function(t){return this.keyState[t]===i.Released},t.prototype.isDown=function(t){return this.keyState[t]>=i.Down},t.prototype.gt=function(){var t=this;this.keyState.forEach(function(n,r){n===i.Pressed&&(t.keyState[r]=i.Down),n===i.Released&&(t.keyState[r]=i.Up)})},t.prototype.bt=function(t){var n=t.key.toLowerCase();return n in v?v[n]:-1},t}();function M(t,n){return Object(o.s)(t.width,t.height,!1),new Promise(function(r){var e=new a.f(t,n,function(){e.xt(!0),e.input=new p,r(e)})})}function d(t,n,r){var e=0,i=[],o=new l,f=0,c=0,s=1;window.requestAnimationFrame(function h(l){try{if(a.b){var v=Math.floor(l/1e3);v!==e&&i.length>0&&(console.log("Upd="+(i.reduce(function(t,n){return t+n})/i.length).toFixed(3)+"ms; r="+f+", s="+c+", u="+i.length+"; "+o.getFramerate().toFixed(2)+"Hz",t.mt()),i.length=0,f=c=0),e=v}var p=o.getFramerate(),M=void 0;M=p>=u-1&&p<=u+1?o.doSimplest(l):o.doStandard(l);for(var d=0;d<M;d++)if(!(s-- >1)){var _=window.performance.now(),m=d<M-1;t.xt(m),n.next(),s=t._t(),m||i.push(window.performance.now()-_)}a.b&&(M>0&&(f+=1),M>1&&(c+=M-1)),window.requestAnimationFrame(h),t.input.gt()}catch(t){r&&r(t)}})}r.d(n,"a",function(){return M}),r.d(n,"b",function(){return d})},,,,,,,function(t,n,r){t.exports=r(12)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"startStandalone",function(){return startStandalone}),__webpack_require__.d(__webpack_exports__,"startGame",function(){return startGame}),__webpack_require__.d(__webpack_exports__,"vdp",function(){return vdp}),__webpack_require__.d(__webpack_exports__,"input",function(){return input});var _vdp_runloop__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4),_vdp_vdp__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3);__webpack_require__.d(__webpack_exports__,"VDP",function(){return _vdp_vdp__WEBPACK_IMPORTED_MODULE_1__.f}),__webpack_require__.d(__webpack_exports__,"CopySource",function(){return _vdp_vdp__WEBPACK_IMPORTED_MODULE_1__.a}),__webpack_require__.d(__webpack_exports__,"LineColorArray",function(){return _vdp_vdp__WEBPACK_IMPORTED_MODULE_1__.c}),__webpack_require__.d(__webpack_exports__,"LineTransformationArray",function(){return _vdp_vdp__WEBPACK_IMPORTED_MODULE_1__.d});var _vdp_color__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1);__webpack_require__.d(__webpack_exports__,"color",function(){return _vdp_color__WEBPACK_IMPORTED_MODULE_2__.a});var gl_matrix__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(2);__webpack_require__.d(__webpack_exports__,"vec2",function(){return gl_matrix__WEBPACK_IMPORTED_MODULE_3__.c}),__webpack_require__.d(__webpack_exports__,"mat3",function(){return gl_matrix__WEBPACK_IMPORTED_MODULE_3__.a});var __read=function(t,n){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var e,i,o=r.call(t),a=[];try{for(;(void 0===n||n-- >0)&&!(e=o.next()).done;)a.push(e.value)}catch(t){i={error:t}}finally{try{e&&!e.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},vdp,input;function startStandalone(_a){var resourceDir=_a.resourceDir,scriptFile=_a.scriptFile;resourceDir=resourceDir||"build/",scriptFile=scriptFile||resourceDir+"game-main.js",Promise.all([window.fetch(scriptFile).then(function(t){if(!t.ok)throw new Error(scriptFile+" not found");return t.text()}),Object(_vdp_runloop__WEBPACK_IMPORTED_MODULE_0__.a)(document.querySelector("#glCanvas"),resourceDir)]).then(function(_a){var _b=__read(_a,2),code=_b[0],vdp=_b[1];code=code.replace(/^import .*?;/gm,"").replace(/^export function/gm,"function"),code="(function(vdp,input,color,vec2,mat3){var window ='Please play fair';"+code+";return main;})";var mainFunc=eval(code)(vdp,vdp.input,vdp.color,vdp.vec2,vdp.mat3);if(!mainFunc)throw new Error("Check that your script contains a function *main()");Object(_vdp_runloop__WEBPACK_IMPORTED_MODULE_0__.b)(vdp,mainFunc())})}function startGame(t,n,r){var e=void 0===r?{}:r,i=e.resourceDir,o=e.onError;function a(t){o&&o(t),console.error("Exception in the game",t)}"string"!=typeof i&&(i="./build/"),Object(_vdp_runloop__WEBPACK_IMPORTED_MODULE_0__.a)(document.querySelector(t),i).then(function(t){input=(vdp=t).input;try{Object(_vdp_runloop__WEBPACK_IMPORTED_MODULE_0__.b)(t,n(t),a)}catch(t){a(t)}}).catch(a)}}])});